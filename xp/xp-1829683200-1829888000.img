rowset to public
go

dump tran master with no_log
go

if (charindex('6.00', @@version) > 0)
    begin
    if (exists (select * from sysobjects
            where name = 'sp_procedures_rowset' and type = 'P '))
        begin
        drop procedure sp_procedures_rowset
        dump tran master with no_log
        end
    end
go


print ''
print 'creating sp_schemata_rowset'
go

/*  6.0 and 6.5 and 7.0 version */
create procedure sp_schemata_rowset
    (
    @schema_name    varchar(90) = null, 
    @schema_owner   varchar(90) = null
    )       
as
    select  distinct
        CATALOG_NAME            = db_name(),
        SCHEMA_NAME         = user_name(o.uid), 
        SCHEMA_OWNER            = user_name(o.uid), 
        DEFAULT_CHARACTER_SET_CATALOG   = convert(sysname,'master'),
        DEFAULT_CHARACTER_SET_SCHEMA    = convert(sysname,'dbo'),
        DEFAULT_CHARACTER_SET_NAME  = convert(sysname,a_cha.name)
    from    
        sysobjects o,
        master.dbo.sysconfigures    cfg,
        master.dbo.syscharsets      a_cha, /* charset/1001, not sortorder */
        master.dbo.syscharsets      b_cha  /* sortorder/2001, not charset */
    where   
        (@schema_name is null or @schema_name = user_name(o.uid))
    and     (@schema_owner is null or @schema_owner = user_name(o.uid))
    and a_cha.type = 1001 /* type is charset */
    and     b_cha.type = 2001 /* type is sortorder */
    and     a_cha.id = b_cha.csid
    and     b_cha.id = cfg.value
    order by 2
go
dump tran master with no_log
go

if (charindex('8.00', @@version) > 0)
    drop procedure sp_schemata_rowset
else
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.0 SQL Server.'
    print 'Ignore the following errors.'
end
go

/* 8.0 version */
create procedure sp_schemata_rowset
    (
    @schema_name    sysname = null, 
    @schema_owner   sysname = null
    )       
as
    select  distinct
        CATALOG_NAME            = db_name(),
        SCHEMA_NAME         = user_name(o.uid), 
        SCHEMA_OWNER            = user_name(o.uid), 
        DEFAULT_CHARACTER_SET_CATALOG   = convert(sysname,N'master'),
        DEFAULT_CHARACTER_SET_SCHEMA    = convert(sysname,N'dbo'),
        DEFAULT_CHARACTER_SET_NAME  = convert(sysname,a_cha.name)
    from    
        sysobjects o,
        master.dbo.syscharsets      a_cha /* charset/1001, not sortorder */
    where   
        (@schema_name is null or @schema_name = user_name(o.uid))
    and     (@schema_owner is null or @schema_owner = user_name(o.uid))
    and a_cha.type = 1001 /* type is charset */
    and     a_cha.id = convert(tinyint, DatabasePropertyEx(db_name(), 'sqlcharset')) /* what is charset of a table? */
    order by 2
go

dump tran master with no_log
go

/* The following stored procedure is used for Sphinx and Hydra */
create procedure sp_schemata_rowset;3
as
    select
        CATALOG_NAME            = convert(sysname,' '),
        SCHEMA_NAME         = convert(sysname,' '), 
        SCHEMA_OWNER            = convert(sysname,' '), 
        DEFAULT_CHARACTER_SET_CATALOG   = convert(sysname,' '),
        DEFAULT_CHARACTER_SET_SCHEMA    = convert(sysname,' '),
        DEFAULT_CHARACTER_SET_NAME  = convert(sysname,' ')
    where   1=0
go
grant execute on sp_schemata_rowset to public
go

dump tran master with no_log
go
if (charindex('6.00', @@version) > 0)
    begin
    if (exists (select * from sysobjects
            where name = 'sp_schemata_rowset' and type = 'P '))
        begin
        drop procedure sp_schemata_rowset
        dump tran master with no_log
        end
    end
go


print ''
print 'creating sp_statistics_rowset'
go


/*  6.0 and 6.5 version */
create procedure sp_statistics_rowset
    (
    @table_name varchar(255),
    @table_schema   varchar(255) = null  
    )
as
    select  db_name()               as TABLE_CATALOG,       
        user_name(o.uid)            as TABLE_SCHEMA,
        o.name                  as TABLE_NAME,
        x.rows                  as CARDINALITY
    from    sysobjects o, sysindexes x, sysusers u
    where   o.type in ('U')
    and     o.name = @table_name
    and     (@table_schema is null or @table_schema = user_name(o.uid))
    and     x.id = o.id
    and     x.indid in (0,1)    /*If there are no indexes then table stats are in a row with indid =0 */
    and     u.uid = user_id() /* constrain sysusers uid for use in subquery */
    and     (
        suser_id() = 1   /* User is the System Administrator */
        or o.uid = user_id()     /* User created the object */
        /* here's the magic... select the highest precedence of permissions in the order (user,group,public)  */
        or (    (select max(((sign(uid)*abs(uid-16383))*2)+(protecttype&1))
            from sysprotects p
            where p.id = o.id
            /* get rows for public,current user,user's group */
            and (p.uid = 0 or p.uid = user_id() or p.uid = u.gid)
            /* check for SELECT,EXECUTE privilege */
            and (action in (193,224)))&1     /* more magic...normalize GRANT */
            ) = 1   /* final magic...compare Grants   */
           )
    order by 2, 3
go
dump tran master with no_log
go
create procedure sp_statistics_rowset;2
    (
    @table_schema   varchar(255) = null  
    )
as
    select  db_name()               as TABLE_CATALOG,       
        user_name(o.uid)            as TABLE_SCHEMA,
        o.name                  as TABLE_NAME,
        x.rows                  as CARDINALITY
    from    sysobjects o, sysindexes x, sysusers u
    where   o.type in ('U')
    and     (@table_schema is null or @table_schema = user_name(o.uid))
    and     x.id = o.id
    and     u.uid = user_id() /* constrain sysusers uid for use in subquery */
    and     (
        suser_id() = 1   /* User is the System Administrator */
        or o.uid = user_id()     /* User created the object */
        /* here's the magic... select the highest precedence of permissions in the order (user,group,public)  */
        or (    (select max(((sign(uid)*abs(uid-16383))*2)+(protecttype&1))
            from sysprotects p
            where p.id = o.id
            /* get rows for public,current user,user's group */
            and (p.uid = 0 or p.uid = user_id() or p.uid = u.gid)
            /* check for SELECT,EXECUTE privilege */
            and (action in (193,224)))&1     /* more magic...normalize GRANT */
            ) = 1   /* final magic...compare Grants   */
           )        
    order by 2, 3
go
dump tran master with no_log
go

if (charindex('7.00', @@version) > 0 or
    charindex('8.00', @@version) > 0)
    drop procedure sp_statistics_rowset
else
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.0 SQL Server.'
    print 'Ignore the following errors.'
end
go

/*  8.0 version */
create procedure sp_statistics_rowset
    (
    @table_name sysname,
    @table_schema   sysname = null   
    )
as
    select  db_name()               as TABLE_CATALOG,       
        user_name(o.uid)            as TABLE_SCHEMA,
        o.name                  as TABLE_NAME,
        x.rows                  as CARDINALITY
    from    sysobjects o, sysindexes x
    where   o.type in ('U')
    and     o.name = @table_name
    and     (@table_schema is null or @table_schema = user_name(o.uid))
    and     x.id = o.id
    and     x.indid in (0,1)    /*If there are no indexes then table stats are in a row with indid =0 */
    and     permissions(o.id) <> 0
    order by 2, 3
go
dump tran master with no_log
go
create procedure sp_statistics_rowset;2
    (
    @table_schema   sysname = null   
    )
as
    select  db_name()               as TABLE_CATALOG,       
        user_name(o.uid)            as TABLE_SCHEMA,
        o.name                  as TABLE_NAME,
        x.rows                  as CARDINALITY
    from    sysobjects o, sysindexes x
    where   o.type in ('U')
    and     (@table_schema is null or @table_schema = user_name(o.uid))
    and     x.id = o.id
    and     x.indid in (0,1)    /*If there are no indexes then table stats are in a row with indid =0 */
    and     permissions(o.id) <> 0
    order by 2, 3
go

grant execute on sp_statistics_rowset to public
go

dump tran master with no_log
go
if (charindex('6.00', @@version) > 0)
    begin
    if (exists (select * from sysobjects
            where name = 'sp_statistics_rowset' and type = 'P '))
        begin
        drop procedure sp_statistics_rowset
        dump tran master with no_log
        end
    end
go


print ''
print 'creating sp_tables_rowset'
go


/*  Procedure for 6.50 and earlier servers */
create procedure sp_tables_rowset
    (
    @table_name varchar(255), 
    @table_schema   varchar(255) = null,    
    @table_type varchar(255) = null 
    )
as
    select  TABLE_CATALOG   = db_name(),
        TABLE_SCHEMA    = user_name(o.uid),
        TABLE_NAME  = o.name,
        TABLE_TYPE  = convert(varchar(30),
                    case o.type 
                    when 'U' then 'TABLE'
                    when 'V' then 'VIEW'
                    when 'S' then 'SYSTEM TABLE'
                    end),
        TABLE_GUID  = convert(binary(16), null),
        DESCRIPTION = convert(varchar(1), null),
        TABLE_PROPID    = convert(int,null),
        DATE_CREATED    = o.crdate,
        DATE_MODIFIED   = convert(datetime,null)
    from    sysusers u, sysobjects o
    where   o.type in ('U','V','S')
    and     o.name = @table_name
    and     (   @table_schema is null
        or  @table_schema = user_name(o.uid)
        )
    and     (
            @table_type is null
        or  @table_type = case o.type 
                    when 'U' then 'TABLE'
                    when 'V' then 'VIEW'
                    when 'S' then 'SYSTEM TABLE'
                    end
        )
    and     u.uid = user_id() /* constrain sysusers uid for use in subquery */
    and     (
        suser_id() = 1   /* User is the System Administrator */
        or o.uid = user_id()     /* User created the object */
        /* here's the magic... select the highest precedence of permissions in the order (user,group,public)  */
        or (    (select max(((sign(uid)*abs(uid-16383))*2)+(protecttype&1))
            from sysprotects p
            /* join to correlate with all rows in sysobjects */
            where p.id = o.id
            /* get rows for public,current user,user's group */
            and (p.uid = 0 or p.uid = user_id() or p.uid = u.gid)
            /* check for SELECT,EXECUTE privilege */
            and (action in (193,224)))&1     /* more magic...normalize GRANT */
            ) = 1   /* final magic...compare Grants   */
        )       
    order by 4, 2, 3
go
dump tran master with no_log
go
create procedure sp_tables_rowset;2
    (
    @table_schema   varchar(255) = null,    
    @table_type varchar(255) = null 
    )
as
    select  TABLE_CATALOG   = db_name(),
        TABLE_SCHEMA    = user_name(o.uid),
        TABLE_NAME  = o.name,
        TABLE_TYPE  = convert(varchar(30),
                    case o.type 
                    when 'U' then 'TABLE'
                    when 'V' then 'VIEW'
                    when 'S' then 'SYSTEM TABLE'
                    end),
        TABLE_GUID  = convert(binary(16), null),
        DESCRIPTION = convert(varchar(1), null),
        TABLE_PROPID    = convert(int,null),
        DATE_CREATED    = o.crdate,
        DATE_MODIFIED   = convert(datetime,null)
    from    sysusers u, sysobjects o
    where   o.type in ('U','V','S')
    and     (   @table_schema is null
        or  @table_schema = user_name(o.uid)
        )
    and     (
            @table_type is null
        or  @table_type = case o.type 
                    when 'U' then 'TABLE'
                    when 'V' then 'VIEW'
                    when 'S' then 'SYSTEM TABLE'
                    end
        )
    and     u.uid = user_id() /* constrain sysusers uid for use in subquery */
    and     (
        suser_id() = 1   /* User is the System Administrator */
        or o.uid = user_id()     /* User created the object */
        /* here's the magic... select the highest precedence of permissions in the order (user,group,public)  */
        or (    (select max(((sign(uid)*abs(uid-16383))*2)+(protecttype&1))
            from sysprotects p
            /* join to correlate with all rows in sysobjects */
            where p.id = o.id
            /* get rows for public,current user,user's group */
            and (p.uid = 0 or p.uid = user_id() or p.uid = u.gid)
            /* check for SELECT,EXECUTE privilege */
            and (action in (193,224)))&1     /* more magic...normalize GRANT */
            ) = 1   /* final magic...compare Grants   */
        )       
    order by 4, 2, 3
go
dump tran master with no_log
go

if (charindex('7.00', @@version) > 0 or
    charindex('8.00', @@version) > 0)
    drop procedure sp_tables_rowset
else
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.0 SQL Server.'
    print 'Ignore the following errors.'
end
go

/*  Procedure for 8.0 server */
create procedure sp_tables_rowset
    (
    @table_name sysname, 
    @table_schema   sysname = null, 
    @table_type nvarchar(255) = null 
    )
as
    select  *
    from    (select TABLE_CATALOG   = db_name(),
            TABLE_SCHEMA    = user_name(uid),
            TABLE_NAME  = name,
            TABLE_TYPE  = convert(nvarchar(30),
                        case type 
                        when 'U' then 
                            case when ObjectProperty(id, 'IsMSShipped') = 0
                            then N'TABLE' else N'SYSTEM TABLE' end
                        when 'S' then N'SYSTEM TABLE'
                        when 'V' then 
                            case when ObjectProperty(id, 'IsMSShipped') = 0
                            then N'VIEW' else N'SYSTEM VIEW' end
                        end),
            TABLE_GUID  = convert(uniqueidentifier, null),
            DESCRIPTION = convert(nvarchar(1), null),
            TABLE_PROPID    = convert(int,null),
            DATE_CREATED    = crdate,
            DATE_MODIFIED   = convert(datetime,null)
        from    sysobjects
        where   name = @table_name
        and type in ('U','V','S')
        and permissions(id) <> 0
        ) as o

    where   (@table_schema is null or @table_schema = TABLE_SCHEMA)
    and     (@table_type is null or @table_type = TABLE_TYPE)   
    order by 4, 2, 3
go
dump tran master with no_log
go
create procedure sp_tables_rowset;2
    (
    @table_schema   sysname = null, 
    @table_type nvarchar(255) = null 
    )
as
    select  *
    from    (select TABLE_CATALOG   = db_name(),
            TABLE_SCHEMA    = user_name(uid),
            TABLE_NAME  = name,
            TABLE_TYPE  = convert(nvarchar(30),
                        case type 
                        when 'U' then 
                            case when ObjectProperty(id, 'IsMSShipped') = 0
                            then N'TABLE' else N'SYSTEM TABLE' end
                        when 'S' then N'SYSTEM TABLE'
                        when 'V' then 
                            case when ObjectProperty(id, 'IsMSShipped') = 0
                            then N'VIEW' else N'SYSTEM VIEW' end
                        end),
            TABLE_GUID  = convert(uniqueidentifier, null),
            DESCRIPTION = convert(nvarchar(1), null),
            TABLE_PROPID    = convert(int,null),
            DATE_CREATED    = crdate,
            DATE_MODIFIED   = convert(datetime,null)
        from    sysobjects
        where   type in ('U','V','S')
        and permissions(id) <> 0
        ) as o

    where   (@table_schema is null or @table_schema = TABLE_SCHEMA)
    and     (@table_type is null or @table_type = TABLE_TYPE)   
    order by 4, 2, 3
go
dump tran master with no_log
go
create procedure sp_tables_rowset;5
    (
    @table_server       sysname,
    @table_catalog      sysname = null,
    @table_name     sysname = null,
    @table_schema       sysname = null,
    @table_type     sysname = null
    )
as
    select
        TABLE_CATALOG,
        TABLE_SCHEMA,
        TABLE_NAME,
        TABLE_TYPE,
        TABLE_GUID,
        DESCRIPTION
    --  TABLE_PROPID,
    --  DATE_CREATED,
    --  DATE_MODIFIED
    from master.dbo.SYSREMOTE_TABLES (
                @table_server,
                @table_catalog,
                @table_schema,
                @table_name,
                @table_type )
    order by 4,1,2,3
go

grant execute on sp_tables_rowset to public
go

dump tran master with no_log
go
if (charindex('6.00', @@version) > 0)
    begin
    if (exists (select * from sysobjects
            where name = 'sp_tables_rowset' and type = 'P '))
        begin
        drop procedure sp_tables_rowset
        dump tran master with no_log
        end
    end
go



print ''
print 'creating sp_tables_info_rowset'
go


/*  Procedure for 6.50 and earlier servers */
create procedure sp_tables_info_rowset
    (
    @table_name varchar(255), 
    @table_schema   varchar(255) = null,    
    @table_type varchar(255) = null 
    )
as
    select  TABLE_CATALOG       = db_name(),
        TABLE_SCHEMA        = user_name(o.uid),
        TABLE_NAME      = o.name,
        TABLE_TYPE      = convert(varchar(30),
                        case o.type 
                        when 'U' then 'TABLE'
                        when 'V' then 'VIEW'
                        when 'S' then 'SYSTEM TABLE'
                        end),
        TABLE_GUID      = convert(binary(16), null),
        BOOKMARKS       = convert(bit, 1),
        BOOKMARK_TYPE       = convert(int, 1 /*DBPROPVAL_BMK_NUMERIC*/),
        BOOKMARK_DATATYPE   = convert(smallint, 19 /*DBTYPE_UI4 */),
        BOOKMARK_MAXIMUM_LENGTH = convert(int, 4),
        BOOKMARK_INFORMATION    = convert(int, 0),
        TABLE_VERSION       = convert(int, o.schema_ver),
        CARDINALITY     = x.rows,
        DESCRIPTION     = convert(varchar(1), null),
        TABLE_PROPID        = convert(int, null)

    from    sysusers u, 
        sysobjects o,
        sysindexes x

    where   o.type in ('U','V','S')
    and     o.name = @table_name
    and     (   @table_schema is null
        or  @table_schema = user_name(o.uid)
        )
    and     (
            @table_type is null
        or  @table_type = case o.type 
                    when 'U' then 'TABLE'
                    when 'V' then 'VIEW'
                    when 'S' then 'SYSTEM TABLE'
                    end
        )
    and o.id *= x.id
    and x.indid in (0,1)
    and     u.uid = user_id() /* constrain sysusers uid for use in subquery */
    and     (
        suser_id() = 1   /* User is the System Administrator */
        or o.uid = user_id()     /* User created the object */
        /* here's the magic... select the highest precedence of permissions in the order (user,group,public)  */
        or (    (select max(((sign(uid)*abs(uid-16383))*2)+(protecttype&1))
            from sysprotects p
            /* join to correlate with all rows in sysobjects */
            where p.id = o.id
            /* get rows for public,current user,user's group */
            and (p.uid = 0 or p.uid = user_id() or p.uid = u.gid)
            /* check for SELECT,EXECUTE privilege */
            and (action in (193,224)))&1     /* more magic...normalize GRANT */
            ) = 1   /* final magic...compare Grants   */
        )       
    order by 4, 2, 3
go
dump tran master with no_log
go
create procedure sp_tables_info_rowset;2
    (
    @table_schema   varchar(255) = null,    
    @table_type varchar(255) = null 
    )
as
    select  TABLE_CATALOG       = db_name(),
        TABLE_SCHEMA        = user_name(o.uid),
        TABLE_NAME      = o.name,
        TABLE_TYPE      = convert(varchar(30),
                        case o.type 
                        when 'U' then 'TABLE'
                        when 'V' then 'VIEW'
                        when 'S' then 'SYSTEM TABLE'
                        end),
        TABLE_GUID      = convert(binary(16), null),
        BOOKMARKS       = convert(bit, 1),
        BOOKMARK_TYPE       = convert(int, 1 /*DBPROPVAL_BMK_NUMERIC*/),
        BOOKMARK_DATATYPE   = convert(smallint, 19 /*DBTYPE_UI4 */),
        BOOKMARK_MAXIMUM_LENGTH = convert(int, 4),
        BOOKMARK_INFORMATION    = convert(int, 0),
        TABLE_VERSION       = convert(int, o.schema_ver),
        CARDINALITY     = x.rows,
        DESCRIPTION     = convert(varchar(1), null),
        TABLE_PROPID        = convert(int, null)

    from    sysusers u, 
        sysobjects o,
        sysindexes x

    where   o.type in ('U','V','S')
    and     (   @table_schema is null
        or  @table_schema = user_name(o.uid)
        )
    and     (
            @table_type is null
        or  @table_type = case o.type 
                    when 'U' then 'TABLE'
                    when 'V' then 'VIEW'
                    when 'S' then 'SYSTEM TABLE'
                    end
        )
    and o.id *= x.id
    and x.indid in (0,1)
    and     u.uid = user_id() /* constrain sysusers uid for use in subquery */
    and     (
        suser_id() = 1   /* User is the System Administrator */
        or o.uid = user_id()     /* User created the object */
        /* here's the magic... select the highest precedence of permissions in the order (user,group,public)  */
        or (    (select max(((sign(uid)*abs(uid-16383))*2)+(protecttype&1))
            from sysprotects p
            /* join to correlate with all rows in sysobjects */
            where p.id = o.id
            /* get rows for public,current user,user's group */
            and (p.uid = 0 or p.uid = user_id() or p.uid = u.gid)
            /* check for SELECT,EXECUTE privilege */
            and (action in (193,224)))&1     /* more magic...normalize GRANT */
            ) = 1   /* final magic...compare Grants   */
        )       
    order by 4, 2, 3
go
dump tran master with no_log
go

if (charindex('7.00', @@version) > 0 or
    charindex('8.00', @@version) > 0)
    drop procedure sp_tables_info_rowset
else
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 7.0 SQL Server.'
    print 'Ignore the following errors.'
end
go

/*  Procedure for 7.0 server */
create procedure sp_tables_info_rowset
    (
    @table_name sysname, 
    @table_schema   sysname = null, 
    @table_type nvarchar(255) = null 
    )
as
    select  *
    from    (select TABLE_CATALOG       = db_name(),
            TABLE_SCHEMA        = user_name(o.uid),
            TABLE_NAME      = o.name,
            TABLE_TYPE      = convert(nvarchar(30),
                            case o.type 
                            when 'U' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'TABLE' else N'SYSTEM TABLE' end
                            when 'S' then N'SYSTEM TABLE'
                            when 'V' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'VIEW' else N'SYSTEM VIEW' end
                            end),
            TABLE_GUID      = convert(uniqueidentifier, null),
            BOOKMARKS       = convert(bit, 1),
            BOOKMARK_TYPE       = convert(int, 1 /*DBPROPVAL_BMK_NUMERIC*/),
            BOOKMARK_DATATYPE   = convert(smallint, 19 /*DBTYPE_UI4 */),
            BOOKMARK_MAXIMUM_LENGTH = convert(int, 4),
            BOOKMARK_INFORMATION    = convert(int, 0),
            TABLE_VERSION       = convert(int, o.schema_ver),
            CARDINALITY     = x.rows,
            DESCRIPTION     = convert(nvarchar(1), null),
            TABLE_PROPID        = convert(int, null) 
    
        from    sysobjects o left join sysindexes x on o.id = x.id and x.indid in (0,1)
        where   o.name = @table_name
        and     o.type in ('U','V','S')
        and permissions(o.id) <> 0) as t

    where   (@table_schema is null or @table_schema = TABLE_SCHEMA)
    and     (@table_type is null or @table_type = TABLE_TYPE)
    order by 4, 2, 3
go
dump tran master with no_log
go
create procedure sp_tables_info_rowset;2
    (
    @table_schema   sysname = null, 
    @table_type nvarchar(255) = null 
    )
as
    select  *
    from    (select TABLE_CATALOG       = db_name(),
            TABLE_SCHEMA        = user_name(o.uid),
            TABLE_NAME      = o.name,
            TABLE_TYPE      = convert(nvarchar(30),
                            case o.type 
                            when 'U' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'TABLE' else N'SYSTEM TABLE' end
                            when 'S' then N'SYSTEM TABLE'
                            when 'V' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'VIEW' else N'SYSTEM VIEW' end
                            end),
            TABLE_GUID      = convert(uniqueidentifier, null),
            BOOKMARKS       = convert(bit, 1),
            BOOKMARK_TYPE       = convert(int, 1 /*DBPROPVAL_BMK_NUMERIC*/),
            BOOKMARK_DATATYPE   = convert(smallint, 19 /*DBTYPE_UI4 */),
            BOOKMARK_MAXIMUM_LENGTH = convert(int, 4),
            BOOKMARK_INFORMATION    = convert(int, 0),
            TABLE_VERSION       = convert(int, o.schema_ver),
            CARDINALITY     = x.rows,
            DESCRIPTION     = convert(nvarchar(1), null),
            TABLE_PROPID        = convert(int, null) 
    
        from    sysobjects o left join sysindexes x on o.id = x.id and x.indid in (0,1)
        where   o.type in ('U','V','S')
        and permissions(o.id) <> 0) as t

    where   (@table_schema is null or @table_schema = TABLE_SCHEMA)
    and     (@table_type is null or @table_type = TABLE_TYPE)
    order by 4, 2, 3
go

dump tran master with no_log
go

if (charindex('8.00', @@version) > 0)
    drop procedure sp_tables_info_rowset
else
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.0 SQL Server.'
    print 'Ignore the following errors.'
end
go

/*  Procedure for 8.0 server */
create procedure sp_tables_info_rowset
    (
    @table_name sysname, 
    @table_schema   sysname = null, 
    @table_type nvarchar(255) = null 
    )
as
    select  *
    from    (select TABLE_CATALOG       = db_name(),
            TABLE_SCHEMA        = user_name(o.uid),
            TABLE_NAME      = o.name,
            TABLE_TYPE      = convert(nvarchar(30),
                            case o.type 
                            when 'U' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'TABLE' else N'SYSTEM TABLE' end
                            when 'S' then N'SYSTEM TABLE'
                            when 'V' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'VIEW' else N'SYSTEM VIEW' end
                            end),
            TABLE_GUID      = convert(uniqueidentifier, null),
            BOOKMARKS       = convert(bit, 1),
            BOOKMARK_TYPE       = convert(int, 1 /*DBPROPVAL_BMK_NUMERIC*/),
            BOOKMARK_DATATYPE   = convert(smallint, 19 /*DBTYPE_UI4 */),
            BOOKMARK_MAXIMUM_LENGTH = convert(int, 4),
            BOOKMARK_INFORMATION    = convert(int, 0),
            TABLE_VERSION       = convert(bigint, ObjectPropertyEx(o.id, 'objectversion')),
            CARDINALITY     = x.rows,
            DESCRIPTION     = convert(nvarchar(1), null),
            TABLE_PROPID        = convert(int, null) 
    
        from    sysobjects o left join sysindexes x on o.id = x.id and x.indid in (0,1)
        where   o.name = @table_name
        and     o.type in ('U','V','S')
        and permissions(o.id) <> 0) as t

    where   (@table_schema is null or @table_schema = TABLE_SCHEMA)
    and     (@table_type is null or @table_type = TABLE_TYPE)
    order by 4, 2, 3
go
dump tran master with no_log
go
create procedure sp_tables_info_rowset;2
    (
    @table_schema   sysname = null, 
    @table_type nvarchar(255) = null 
    )
as
    select  *
    from    (select TABLE_CATALOG       = db_name(),
            TABLE_SCHEMA        = user_name(o.uid),
            TABLE_NAME      = o.name,
            TABLE_TYPE      = convert(nvarchar(30),
                            case o.type 
                            when 'U' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'TABLE' else N'SYSTEM TABLE' end
                            when 'S' then N'SYSTEM TABLE'
                            when 'V' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'VIEW' else N'SYSTEM VIEW' end
                            end),
            TABLE_GUID      = convert(uniqueidentifier, null),
            BOOKMARKS       = convert(bit, 1),
            BOOKMARK_TYPE       = convert(int, 1 /*DBPROPVAL_BMK_NUMERIC*/),
            BOOKMARK_DATATYPE   = convert(smallint, 19 /*DBTYPE_UI4 */),
            BOOKMARK_MAXIMUM_LENGTH = convert(int, 4),
            BOOKMARK_INFORMATION    = convert(int, 0),
            TABLE_VERSION       = convert(bigint, ObjectPropertyEx(o.id, 'objectversion')),
            CARDINALITY     = x.rows,
            DESCRIPTION     = convert(nvarchar(1), null),
            TABLE_PROPID        = convert(int, null) 
    
        from    sysobjects o left join sysindexes x on o.id = x.id and x.indid in (0,1)
        where   o.type in ('U','V','S')
        and permissions(o.id) <> 0) as t

    where   (@table_schema is null or @table_schema = TABLE_SCHEMA)
    and     (@table_type is null or @table_type = TABLE_TYPE)
    order by 4, 2, 3
go

grant execute on sp_tables_info_rowset to public
go

dump tran master with no_log
go

if (charindex('6.00', @@version) > 0)
    begin
    if (exists (select * from sysobjects
        where name = 'sp_tables_info_rowset' and type = 'P '))
        begin
        drop procedure sp_tables_info_rowset
        dump tran master with no_log
        end
    end
go

print ''
print 'creating sp_tables_info_rowset_64'
go


/*  Procedure for 6.50 and earlier servers */
create procedure sp_tables_info_rowset_64
    (
    @table_name varchar(255), 
    @table_schema   varchar(255) = null,    
    @table_type varchar(255) = null 
    )
as
    select  TABLE_CATALOG       = db_name(),
        TABLE_SCHEMA        = user_name(o.uid),
        TABLE_NAME      = o.name,
        TABLE_TYPE      = convert(varchar(30),
                        case o.type 
                        when 'U' then 'TABLE'
                        when 'V' then 'VIEW'
                        when 'S' then 'SYSTEM TABLE'
                        end),
        TABLE_GUID      = convert(binary(16), null),
        BOOKMARKS       = convert(bit, 1),
        BOOKMARK_TYPE       = convert(int, 1 /*DBPROPVAL_BMK_NUMERIC*/),
        BOOKMARK_DATATYPE   = convert(smallint, 21 /*DBTYPE_UI8 */),
        BOOKMARK_MAXIMUM_LENGTH = convert(int, 8),
        BOOKMARK_INFORMATION    = convert(int, 0),
        TABLE_VERSION       = convert(int, o.schema_ver),
        CARDINALITY     = x.rows,
        DESCRIPTION     = convert(varchar(1), null),
        TABLE_PROPID        = convert(int, null)

    from    sysusers u, 
        sysobjects o,
        sysindexes x

    where   o.type in ('U','V','S')
    and     o.name = @table_name
    and     (   @table_schema is null
        or  @table_schema = user_name(o.uid)
        )
    and     (
            @table_type is null
        or  @table_type = case o.type 
                    when 'U' then 'TABLE'
                    when 'V' then 'VIEW'
                    when 'S' then 'SYSTEM TABLE'
                    end
        )
    and o.id *= x.id
    and x.indid in (0,1)
    and     u.uid = user_id() /* constrain sysusers uid for use in subquery */
    and     (
        suser_id() = 1   /* User is the System Administrator */
        or o.uid = user_id()     /* User created the object */
        /* here's the magic... select the highest precedence of permissions in the order (user,group,public)  */
        or (    (select max(((sign(uid)*abs(uid-16383))*2)+(protecttype&1))
            from sysprotects p
            /* join to correlate with all rows in sysobjects */
            where p.id = o.id
            /* get rows for public,current user,user's group */
            and (p.uid = 0 or p.uid = user_id() or p.uid = u.gid)
            /* check for SELECT,EXECUTE privilege */
            and (action in (193,224)))&1     /* more magic...normalize GRANT */
            ) = 1   /* final magic...compare Grants   */
        )       
    order by 4, 2, 3
go
dump tran master with no_log
go
create procedure sp_tables_info_rowset_64;2
    (
    @table_schema   varchar(255) = null,    
    @table_type varchar(255) = null 
    )
as
    select  TABLE_CATALOG       = db_name(),
        TABLE_SCHEMA        = user_name(o.uid),
        TABLE_NAME      = o.name,
        TABLE_TYPE      = convert(varchar(30),
                        case o.type 
                        when 'U' then 'TABLE'
                        when 'V' then 'VIEW'
                        when 'S' then 'SYSTEM TABLE'
                        end),
        TABLE_GUID      = convert(binary(16), null),
        BOOKMARKS       = convert(bit, 1),
        BOOKMARK_TYPE       = convert(int, 1 /*DBPROPVAL_BMK_NUMERIC*/),
        BOOKMARK_DATATYPE   = convert(smallint, 21 /*DBTYPE_UI8 */),
        BOOKMARK_MAXIMUM_LENGTH = convert(int, 8),
        BOOKMARK_INFORMATION    = convert(int, 0),
        TABLE_VERSION       = convert(int, o.schema_ver),
        CARDINALITY     = x.rows,
        DESCRIPTION     = convert(varchar(1), null),
        TABLE_PROPID        = convert(int, null)

    from    sysusers u, 
        sysobjects o,
        sysindexes x

    where   o.type in ('U','V','S')
    and     (   @table_schema is null
        or  @table_schema = user_name(o.uid)
        )
    and     (
            @table_type is null
        or  @table_type = case o.type 
                    when 'U' then 'TABLE'
                    when 'V' then 'VIEW'
                    when 'S' then 'SYSTEM TABLE'
                    end
        )
    and o.id *= x.id
    and x.indid in (0,1)
    and     u.uid = user_id() /* constrain sysusers uid for use in subquery */
    and     (
        suser_id() = 1   /* User is the System Administrator */
        or o.uid = user_id()     /* User created the object */
        /* here's the magic... select the highest precedence of permissions in the order (user,group,public)  */
        or (    (select max(((sign(uid)*abs(uid-16383))*2)+(protecttype&1))
            from sysprotects p
            /* join to correlate with all rows in sysobjects */
            where p.id = o.id
            /* get rows for public,current user,user's group */
            and (p.uid = 0 or p.uid = user_id() or p.uid = u.gid)
            /* check for SELECT,EXECUTE privilege */
            and (action in (193,224)))&1     /* more magic...normalize GRANT */
            ) = 1   /* final magic...compare Grants   */
        )       
    order by 4, 2, 3
go
dump tran master with no_log
go

if (charindex('7.00', @@version) > 0 or
    charindex('8.00', @@version) > 0)
    drop procedure sp_tables_info_rowset_64
else
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 7.0 SQL Server.'
    print 'Ignore the following errors.'
end
go

/*  Procedure for 7.0 server */
create procedure sp_tables_info_rowset_64
    (
    @table_name sysname, 
    @table_schema   sysname = null, 
    @table_type nvarchar(255) = null 
    )
as
    select  *
    from    (select TABLE_CATALOG       = db_name(),
            TABLE_SCHEMA        = user_name(o.uid),
            TABLE_NAME      = o.name,
            TABLE_TYPE      = convert(nvarchar(30),
                            case o.type 
                            when 'U' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'TABLE' else N'SYSTEM TABLE' end
                            when 'S' then N'SYSTEM TABLE'
                            when 'V' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'VIEW' else N'SYSTEM VIEW' end
                            end),
            TABLE_GUID      = convert(uniqueidentifier, null),
            BOOKMARKS       = convert(bit, 1),
            BOOKMARK_TYPE       = convert(int, 1 /*DBPROPVAL_BMK_NUMERIC*/),
            BOOKMARK_DATATYPE   = convert(smallint, 21 /*DBTYPE_UI8 */),
            BOOKMARK_MAXIMUM_LENGTH = convert(int, 8),
            BOOKMARK_INFORMATION    = convert(int, 0),
            TABLE_VERSION       = convert(int, o.schema_ver),
            CARDINALITY     = x.rows,
            DESCRIPTION     = convert(nvarchar(1), null),
            TABLE_PROPID        = convert(int, null) 
    
        from    sysobjects o left join sysindexes x on o.id = x.id and x.indid in (0,1)
        where   o.name = @table_name
        and     o.type in ('U','V','S')
        and permissions(o.id) <> 0) as t

    where   (@table_schema is null or @table_schema = TABLE_SCHEMA)
    and     (@table_type is null or @table_type = TABLE_TYPE)
    order by 4, 2, 3
go
dump tran master with no_log
go
create procedure sp_tables_info_rowset_64;2
    (
    @table_schema   sysname = null, 
    @table_type nvarchar(255) = null 
    )
as
    select  *
    from    (select TABLE_CATALOG       = db_name(),
            TABLE_SCHEMA        = user_name(o.uid),
            TABLE_NAME      = o.name,
            TABLE_TYPE      = convert(nvarchar(30),
                            case o.type 
                            when 'U' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'TABLE' else N'SYSTEM TABLE' end
                            when 'S' then N'SYSTEM TABLE'
                            when 'V' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'VIEW' else N'SYSTEM VIEW' end
                            end),
            TABLE_GUID      = convert(uniqueidentifier, null),
            BOOKMARKS       = convert(bit, 1),
            BOOKMARK_TYPE       = convert(int, 1 /*DBPROPVAL_BMK_NUMERIC*/),
            BOOKMARK_DATATYPE   = convert(smallint, 21 /*DBTYPE_UI8 */),
            BOOKMARK_MAXIMUM_LENGTH = convert(int, 8),
            BOOKMARK_INFORMATION    = convert(int, 0),
            TABLE_VERSION       = convert(int, o.schema_ver),
            CARDINALITY     = x.rows,
            DESCRIPTION     = convert(nvarchar(1), null),
            TABLE_PROPID        = convert(int, null) 
    
        from    sysobjects o left join sysindexes x on o.id = x.id and x.indid in (0,1)
        where   o.type in ('U','V','S')
        and permissions(o.id) <> 0) as t

    where   (@table_schema is null or @table_schema = TABLE_SCHEMA)
    and     (@table_type is null or @table_type = TABLE_TYPE)
    order by 4, 2, 3
go

dump tran master with no_log
go

if (charindex('8.00', @@version) > 0)
    drop procedure sp_tables_info_rowset_64
else
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.0 SQL Server.'
    print 'Ignore the following errors.'
end
go

/*  Procedure for 8.0 server */
create procedure sp_tables_info_rowset_64
    (
    @table_name sysname, 
    @table_schema   sysname = null, 
    @table_type nvarchar(255) = null 
    )
as
    select  *
    from    (select TABLE_CATALOG       = db_name(),
            TABLE_SCHEMA        = user_name(o.uid),
            TABLE_NAME      = o.name,
            TABLE_TYPE      = convert(nvarchar(30),
                            case o.type 
                            when 'U' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'TABLE' else N'SYSTEM TABLE' end
                            when 'S' then N'SYSTEM TABLE'
                            when 'V' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'VIEW' else N'SYSTEM VIEW' end
                            end),
            TABLE_GUID      = convert(uniqueidentifier, null),
            BOOKMARKS       = convert(bit, 1),
            BOOKMARK_TYPE       = convert(int, 1 /*DBPROPVAL_BMK_NUMERIC*/),
            BOOKMARK_DATATYPE   = convert(smallint, 21 /*DBTYPE_UI8 */),
            BOOKMARK_MAXIMUM_LENGTH = convert(int, 8),
            BOOKMARK_INFORMATION    = convert(int, 0),
            TABLE_VERSION       = convert(bigint, ObjectPropertyEx(o.id, 'objectversion')),
            CARDINALITY     = x.rows,
            DESCRIPTION     = convert(nvarchar(1), null),
            TABLE_PROPID        = convert(int, null) 
    
        from    sysobjects o left join sysindexes x on o.id = x.id and x.indid in (0,1)
        where   o.name = @table_name
        and     o.type in ('U','V','S')
        and permissions(o.id) <> 0) as t

    where   (@table_schema is null or @table_schema = TABLE_SCHEMA)
    and     (@table_type is null or @table_type = TABLE_TYPE)
    order by 4, 2, 3
go
dump tran master with no_log
go
create procedure sp_tables_info_rowset_64;2
    (
    @table_schema   sysname = null, 
    @table_type nvarchar(255) = null 
    )
as
    select  *
    from    (select TABLE_CATALOG       = db_name(),
            TABLE_SCHEMA        = user_name(o.uid),
            TABLE_NAME      = o.name,
            TABLE_TYPE      = convert(nvarchar(30),
                            case o.type 
                            when 'U' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'TABLE' else N'SYSTEM TABLE' end
                            when 'S' then N'SYSTEM TABLE'
                            when 'V' then 
                                case when ObjectProperty(o.id, 'IsMSShipped') = 0
                                then N'VIEW' else N'SYSTEM VIEW' end
                            end),
            TABLE_GUID      = convert(uniqueidentifier, null),
            BOOKMARKS       = convert(bit, 1),
            BOOKMARK_TYPE       = convert(int, 1 /*DBPROPVAL_BMK_NUMERIC*/),
            BOOKMARK_DATATYPE   = convert(smallint, 21 /*DBTYPE_UI8 */),
            BOOKMARK_MAXIMUM_LENGTH = convert(int, 8),
            BOOKMARK_INFORMATION    = convert(int, 0),
            TABLE_VERSION       = convert(bigint, ObjectPropertyEx(o.id, 'objectversion')),
            CARDINALITY     = x.rows,
            DESCRIPTION     = convert(nvarchar(1), null),
            TABLE_PROPID        = convert(int, null) 
    
        from    sysobjects o left join sysindexes x on o.id = x.id and x.indid in (0,1)
        where   o.type in ('U','V','S')
        and permissions(o.id) <> 0) as t

    where   (@table_schema is null or @table_schema = TABLE_SCHEMA)
    and     (@table_type is null or @table_type = TABLE_TYPE)
    order by 4, 2, 3
go

grant execute on sp_tables_info_rowset_64 to public
go

dump tran master with no_log
go

if (charindex('6.00', @@version) > 0)
    begin
    if (exists (select * from sysobjects
        where name = 'sp_tables_info_rowset_64' and type = 'P '))
        begin
        drop procedure sp_tables_info_rowset_64
        dump tran master with no_log
        end
    end
go

print ''
print 'creating sp_table_constraints_rowset'
go


/*  Procedure for 6.50 and earlier servers */
create procedure sp_table_constraints_rowset
    (
    @table_name         varchar(255), 
    @table_schema       varchar(255) = null,
    @table_catalog      varchar(255) = null,
    @constraint_name    varchar(255) = null,
    @constraint_schema  varchar(255) = null,
    @constraint_catalog varchar(255) = null,
    @constraint_type    varchar(255) = null 
    )
as
    select
        CONSTRAINT_CATALOG  = db_name(),
        CONSTRAINT_SCHEMA   = user_name(c_obj.uid),
        CONSTRAINT_NAME     = c_obj.name,
        TABLE_CATALOG       = db_name(),
        TABLE_SCHEMA        = user_name(t_obj.uid),
        TABLE_NAME          = t_obj.name,
        CONSTRAINT_TYPE     = case (c.status & 0xf)
                                when 1 then 'PRIMARY KEY'
                                when 2 then 'UNIQUE'
                                when 3 then 'FOREIGN KEY'
                                when 4 then 'CHECK'
                                end, 
        IS_DEFERRABLE       = convert(tinyint, 0),
        INITIALLY_DEFERRED  = convert(tinyint, 0),
        DESCRIPTION         = convert(varchar(1), null)

    from 
        sysobjects c_obj, sysobjects t_obj, sysconstraints c
    where
            t_obj.name  = @table_name
        and t_obj.type in ('U','S')
        and (@table_catalog is null or @table_catalog = db_name())
        and (@table_schema is null or @table_schema = user_name(t_obj.uid))
        and c.id = t_obj.id
        and (c.status & 0xf) between 1 and 4
        and c_obj.id    = c.constid
        and c_obj.uid   = user_id()
        and (@constraint_name is null or c_obj.name = @constraint_name)
        and (@constraint_catalog is null or @constraint_catalog = db_name())
        and (@constraint_schema is null or @constraint_schema = user_name(c_obj.uid))
        and (@constraint_type is null
            or (c.status & 0xf)
                = case @constraint_type
                    when 'PRIMARY KEY' then 1
                    when 'UNIQUE' then 2
                    when 'FOREIGN KEY' then 3
                    when 'CHECK' then 4
                    end)
order by 2,3,5,6,7 
go
dump tran master with no_log
go
create procedure sp_table_constraints_rowset;2
    (
    @table_schema       varchar(255) = null,
    @table_catalog      varchar(255) = null,
    @constraint_name    varchar(255) = null,
    @constraint_schema  varchar(255) = null,
    @constraint_catalog varchar(255) = null,
    @constraint_type    varchar(255) = null 
    )
as
    select
        CONSTRAINT_CATALOG  = db_name(),
        CONSTRAINT_SCHEMA   = user_name(c_obj.uid),
        CONSTRAINT_NAME     = c_obj.name,
        TABLE_CATALOG       = db_name(),
        TABLE_SCHEMA        = user_name(t_obj.uid),
        TABLE_NAME          = t_obj.name,
        CONSTRAINT_TYPE     = case (c.status & 0xf)
                                when 1 then 'PRIMARY KEY'
                                when 2 then 'UNIQUE'
                                when 3 then 'FOREIGN KEY'
                                when 4 then 'CHECK'
                                end, 
        IS_DEFERRABLE       = convert(tinyint, 0),
        INITIALLY_DEFERRED  = convert(tinyint, 0),
        DESCRIPTION         = convert(varchar(1), null)

    from 
        sysobjects c_obj, sysobjects t_obj, sysconstraints c
    where
            t_obj.type in ('U','S')
        and (@table_catalog is null or @table_catalog = db_name())
        and (@table_schema is null or @table_schema = user_name(t_obj.uid))
        and c.id = t_obj.id
        and (c.status & 0xf) between 1 and 4
        and c_obj.id    = c.constid
        and c_obj.uid   = user_id()
        and (@constraint_name is null or c_obj.name = @constraint_name)
        and (@constraint_catalog is null or @constraint_catalog = db_name())
        and (@constraint_schema is null or @constraint_schema = user_name(c_obj.uid))
        and (@constraint_type is null
            or (c.status & 0xf)
                = case @constraint_type
                    when 'PRIMARY KEY' then 1
                    when 'UNIQUE' then 2
                    when 'FOREIGN KEY' then 3
                    when 'CHECK' then 4
                    end)
order by 2,3,5,6,7 
go
dump tran master with no_log
go


if (charindex('7.00', @@version) > 0 or
    charindex('8.00', @@version) > 0)
    drop procedure sp_table_constraints_rowset
else
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.0 SQL Server.'
    print 'Ignore the following errors.'
end
go

/*  Procedure for 8.0 server */
create procedure sp_table_constraints_rowset
    (
    @table_name         sysname, 
    @table_schema       sysname = null,
    @table_catalog      sysname = null,
    @constraint_name    sysname = null,
    @constraint_schema  sysname = null,
    @constraint_catalog sysname = null,
    @constraint_type    nvarchar(255) = null 
    )
as
    select
        CONSTRAINT_CATALOG  = db_name(),
        CONSTRAINT_SCHEMA   = user_name(c_obj.uid),
        CONSTRAINT_NAME     = c_obj.name,
        TABLE_CATALOG       = db_name(),
        TABLE_SCHEMA        = user_name(t_obj.uid),
        TABLE_NAME          = t_obj.name,
        CONSTRAINT_TYPE     = case (c.status & 0xf)
                                when 1 then N'PRIMARY KEY'
                                when 2 then N'UNIQUE'
                                when 3 then N'FOREIGN KEY'
                                when 4 then N'CHECK'
                                end, 
        IS_DEFERRABLE       = convert(bit, 0),
        INITIALLY_DEFERRED  = convert(bit, 0),
        DESCRIPTION         = convert(nvarchar(1), null)

    from 
        sysobjects c_obj, sysobjects t_obj, sysconstraints c
    where
            t_obj.name  = @table_name
        and t_obj.type in ('U','S')
        and (@table_catalog is null or @table_catalog = db_name())
        and (@table_schema is null or @table_schema = user_name(t_obj.uid))
        and c.id = t_obj.id
        and (c.status & 0xf) between 1 and 4
        and c_obj.id    = c.constid
        and c_obj.uid   = user_id()
        and (@constraint_name is null or c_obj.name = @constraint_name)
        and (@constraint_catalog is null or @constraint_catalog = db_name())
        and (@constraint_schema is null or @constraint_schema = user_name(c_obj.uid))
        and (@constraint_type is null
            or (c.status & 0xf)
                = case @constraint_type
                    when N'PRIMARY KEY' then 1
                    when N'UNIQUE' then 2
                    when N'FOREIGN KEY' then 3
                    when N'CHECK' then 4
                    end)
order by 2,3,5,6,7 
go
dump tran master with no_log
go
create procedure sp_table_constraints_rowset;2
    (
    @table_schema       sysname = null,
    @table_catalog      sysname = null,
    @constraint_name    sysname = null,
    @constraint_schema  sysname = null,
    @constraint_catalog sysname = null,
    @constraint_type    nvarchar(255) = null 
    )
as
    select
        CONSTRAINT_CATALOG  = db_name(),
        CONSTRAINT_SCHEMA   = user_name(c_obj.uid),
        CONSTRAINT_NAME     = c_obj.name,
        TABLE_CATALOG       = db_name(),
        TABLE_SCHEMA        = user_name(t_obj.uid),
        TABLE_NAME          = t_obj.name,
        CONSTRAINT_TYPE     = case (c.status & 0xf)
                                when 1 then N'PRIMARY KEY'
                                when 2 then N'UNIQUE'
                                when 3 then N'FOREIGN KEY'
                                when 4 then N'CHECK'
                                end, 
        IS_DEFERRABLE       = convert(bit, 0),
        INITIALLY_DEFERRED  = convert(bit, 0),
        DESCRIPTION         = convert(nvarchar(1), null)

    from 
        sysobjects c_obj, sysobjects t_obj, sysconstraints c
    where
            t_obj.type in ('U','S')
        and (@table_catalog is null or @table_catalog = db_name())
        and (@table_schema is null or @table_schema = user_name(t_obj.uid))
        and c.id = t_obj.id
        and (c.status & 0xf) between 1 and 4
        and c_obj.id    = c.constid
        and c_obj.uid   = user_id()
        and (@constraint_name is null or c_obj.name = @constraint_name)
        and (@constraint_catalog is null or @constraint_catalog = db_name())
        and (@constraint_schema is null or @constraint_schema = user_name(c_obj.uid))
        and (@constraint_type is null
            or (c.status & 0xf)
                = case @constraint_type
                    when N'PRIMARY KEY' then 1
                    when N'UNIQUE' then 2
                    when N'FOREIGN KEY' then 3
                    when N'CHECK' then 4
                    end)
order by 2,3,5,6,7 
go
dump tran master with no_log


grant execute on sp_table_constraints_rowset to public
go

dump tran master with no_log
go
if (charindex('6.00', @@version) > 0)
    begin
    if (exists (select * from sysobjects
            where name = 'sp_table_constraints_rowset' and type = 'P '))
        begin
        drop procedure sp_table_constraints_rowset
        dump tran master with no_log
        end
    end
go

print ''
print 'creating sp_table_privileges_rowset'
go

/*  Procedure for 6.0 and 6.5 server */
CREATE PROCEDURE sp_table_privileges_rowset
    (
    @table_name varchar(255) = null,
    @table_schema   varchar(255) = null,
    @grantor    varchar(255) = null,
    @grantee    varchar(255) = null
    )
as
IF @table_name is not null
    BEGIN
    select
        GRANTOR     = user_name(p.grantor),
        GRANTEE     = user_name(u.uid),
        TABLE_CATALOG   = db_name(),
        TABLE_SCHEMA    = user_name(o.uid),
        TABLE_NAME  = o.name,
        PRIVILEGE_TYPE  = convert(varchar(30),
                    case p.action
                    when 193 then 'SELECT'
                    when 195 then 'INSERT'
                    when 196 then 'DELETE'
                    when 197 then 'UPDATE'
                    else 'REFERENCES'
                    end),
        IS_GRANTABLE    = convert(bit,case when p.protecttype = 205 then 0 else 1 end)
    from 
        sysprotects p, sysobjects o, sysusers u
    where
        o.name = @table_name
    and (@table_schema is null or @table_schema = user_name(o.uid))
    and (@grantee is null or @grantee = user_name(u.uid))
    and     o.type in ('U','V','S')
    and p.id = o.id
    and     (@grantor is null or @grantor = user_name(p.grantor))
            /* expand groups */
    and     ((p.uid = u.uid and u.uid <> u.gid) or (p.uid = u.gid and u.uid <> u.gid))
    and     p.protecttype <> 206    /* only grant rows */
    and     p.action in (26,193,195,196,197)
    and     o.uid <> u.uid          /* no rows for owner */
    and     not exists (            /* exclude revoke'd privileges */
            select  *
            from    sysprotects p1
            where   p1.protecttype = 206
            and     p1.action = p.action
            and     p1.id = p.id
            and     p1.uid = u.uid)
    union
    select  /*  Add rows for table owner */
        GRANTOR     = user_name(u.uid),
        GRANTEE     = user_name(o.uid),
        TABLE_CATALOG   = db_name(),
        TABLE_SCHEMA    = user_name(o.uid),
        TABLE_NAME  = o.name,
        PRIVILEGE_TYPE  = convert(varchar(30),
                    case v.number
                    when 193 then 'SELECT'
                    when 195 then 'INSERT'
                    when 196 then 'DELETE'
                    when 197 then 'UPDATE'
                    else 'REFERENCES'
                    end),
        IS_GRANTABLE    = convert(bit,1)    
    from 
        sysobjects o, master.dbo.spt_values v, sysusers u
    where
        o.name = @table_name
    and (@table_schema is null or @table_schema = user_name(o.uid))
    and (@grantee is null or @grantee = user_name(o.uid))
    and     o.type in ('U','V','S')
    and     u.uid = 1       /* grantor is dbo of database */
    and (@grantor is null or @grantor = user_name(u.uid))
    and     v.type = 'P'    /* cross product to get all exposed privileges */
    and     v.number in (26,193,195,196,197)
    and     not exists (    /* exclude revoke'd privileges */
            select  *
            from    sysprotects p1
            where   p1.protecttype = 206
            and     p1.action = v.number
            and     p1.id = o.id
            and     p1.uid = o.uid)
    order by 4,5,6,1,2
    END
ELSE
    BEGIN
    select
        GRANTOR     = user_name(p.grantor),
        GRANTEE     = user_name(u.uid),
        TABLE_CATALOG   = db_name(),
        TABLE_SCHEMA    = user_name(o.uid),
        TABLE_NAME  = o.name,
        PRIVILEGE_TYPE  = convert(varchar(30),
                    case p.action
                    when 193 then 'SELECT'
                    when 195 then 'INSERT'
                    when 196 then 'DELETE'
                    when 197 then 'UPDATE'
                    else 'REFERENCES'
                    end),
        IS_GRANTABLE    = convert(bit,case when p.protecttype = 205 then 0 else 1 end)
    from 
        sysprotects p, sysobjects o, sysusers u
    where
        o.type in ('U','V','S')
    and (@table_schema is null or @table_schema = user_name(o.uid))
    and (@grantee is null or @grantee = user_name(u.uid))
    and p.id = o.id
    and     (@grantor is null or @grantor = user_name(p.grantor))
            /* expand groups */
    and     ((p.uid = u.uid and u.uid <> u.gid) or (p.uid = u.gid and u.uid <> u.gid))
    and     p.protecttype <> 206    /* only grant rows */
    and     p.action in (26,193,195,196,197)
    and     o.uid <> u.uid          /* no rows for owner */
    and     not exists (            /* exclude revoke'd privileges */
            select  *
            from    sysprotects p1
            where   p1.protecttype = 206
            and     p1.action = p.action
            and     p1.id = p.id
            and     p1.uid = u.uid)
    union
    select  /*  Add rows for table owner */
        GRANTOR     = user_name(u.uid),
        GRANTEE     = user_name(o.uid),
        TABLE_CATALOG   = db_name(),
        TABLE_SCHEMA    = user_name(o.uid),
        TABLE_NAME  = o.name,
        PRIVILEGE_TYPE  = convert(varchar(30),
                    case v.number
                    when 193 then 'SELECT'
                    when 195 then 'INSERT'
                    when 196 then 'DELETE'
                    when 197 then 'UPDATE'
                    else 'REFERENCES'
                    end),
        IS_GRANTABLE    = convert(bit,1)    
    from 
        sysobjects o, master.dbo.spt_values v, sysusers u
    where
        o.type in ('U','V','S')
    and (@table_schema is null or @table_schema = user_name(o.uid))
    and (@grantee is null or @grantee = user_name(o.uid))
    and     u.uid = 1       /* grantor is dbo of database */
    and (@grantor is null or @grantor = user_name(u.uid))
    and     v.type = 'P'    /* cross product to get all exposed privileges */
    and     v.number in (26,193,195,196,197)
    and     not exists (    /* exclude revoke'd privileges */
            select  *
            from    sysprotects p1
            where   p1.protecttype = 206
            and     p1.action = v.number
            and     p1.id = o.id
            and     p1.uid = o.uid)
    order by 4,5,6,1,2
    END
go
dump tran master with no_log
go
CREATE PROCEDURE sp_table_privileges_rowset;2
    (
    @handle     int output,
    @scrollopt  int output,
    @ccopt      int output,
    @rows       int output,
    @table_name     varchar(255) = null,
    @table_schema   varchar(255) = null,
    @grantor    varchar(255) = null,
    @grantee    varchar(255) = null
    )
as
declare @ret int
SET NOCOUNT ON
create table #sptprivsrowset1
    (
    GRANTOR     sysname not null,
    GRANTEE     sysname not null,
    TABLE_CATALOG   sysname not null,
    TABLE_SCHEMA    sysname not null,
    TABLE_NAME  sysname not null,
    PRIVILEGE_TYPE  sysname not null,
    IS_GRANTABLE    bit not null
    )
    
IF @table_name is not null
    BEGIN
    insert into #sptprivsrowset1
    select
        GRANTOR     = user_name(p.grantor),
        GRANTEE     = user_name(u.uid),
        TABLE_CATALOG   = db_name(),
        TABLE_SCHEMA    = user_name(o.uid),
        TABLE_NAME  = o.name,
        PRIVILEGE_TYPE  = convert(varchar(30),
                    case p.action
                    when 193 then 'SELECT'
                    when 195 then 'INSERT'
                    when 196 then 'DELETE'
                    when 197 then 'UPDATE'
                    else 'REFERENCES'
                    end),
        IS_GRANTABLE    = convert(bit,case when p.protecttype = 205 then 0 else 1 end)
    from 
        sysprotects p, sysobjects o, sysusers u
    where
        o.name = @table_name
    and (@table_schema is null or @table_schema = user_name(o.uid))
    and (@grantee is null or @grantee = user_name(u.uid))
    and     o.type in ('U','V','S')
    and p.id = o.id
    and     (@grantor is null or @grantor = user_name(p.grantor))
            /* expand groups */
    and     ((p.uid = u.uid and u.uid <> u.gid) or (p.uid = u.gid and u.uid <> u.gid))
    and     p.protecttype <> 206    /* only grant rows */
    and     p.action in (26,193,195,196,197)
    and     o.uid <> u.uid          /* no rows for owner */
    and     not exists (            /* exclude revoke'd privileges */
            select  *
            from    sysprotects p1
            where   p1.protecttype = 206
            and     p1.action = p.action
            and     p1.id = p.id
            and     p1.uid = u.uid)
    union
    select  /*  Add rows for table owner */
        GRANTOR     = user_name(u.uid),
        GRANTEE     = user_name(o.uid),
        TABLE_CATALOG   = db_name(),
        TABLE_SCHEMA    = user_name(o.uid),
        TABLE_NAME  = o.name,
        PRIVILEGE_TYPE  = convert(varchar(30),
                    case v.number
                    when 193 then 'SELECT'
                    when 195 then 'INSERT'
                    when 196 then 'DELETE'
                    when 197 then 'UPDATE'
                    else 'REFERENCES'
                    end),
        IS_GRANTABLE    = convert(bit,1)    
    from 
        sysobjects o, master.dbo.spt_values v, sysusers u
    where
        o.name = @table_name
    and (@table_schema is null or @table_schema = user_name(o.uid))
    and (@grantee is null or @grantee = user_name(o.uid))
    and     o.type in ('U','V','S')
    and     u.uid = 1       /* grantor is dbo of database */
    and (@grantor is null or @grantor = user_name(u.uid))
    and     v.type = 'P'    /* cross product to get all exposed privileges */
    and     v.number in (26,193,195,196,197)
    and     not exists (    /* exclude revoke'd privileges */
            select  *
            from    sysprotects p1
            where   p1.protecttype = 206
            and     p1.action = v.number
            and     p1.id = o.id
            and     p1.uid = o.uid)
    order by 4,5,6,1,2
    END
ELSE
    BEGIN
    insert into #sptprivsrowset1
    select
        GRANTOR     = user_name(p.grantor),
        GRANTEE     = user_name(u.uid),
        TABLE_CATALOG   = db_name(),
        TABLE_SCHEMA    = user_name(o.uid),
        TABLE_NAME  = o.name,
        PRIVILEGE_TYPE  = convert(varchar(30),
                    case p.action
                    when 193 then 'SELECT'
                    when 195 then 'INSERT'
                    when 196 then 'DELETE'
                    when 197 then 'UPDATE'
                    else 'REFERENCES'
                    end),
        IS_GRANTABLE    = convert(bit,case when p.protecttype = 205 then 0 else 1 end)
    from 
        sysprotects p, sysobjects o, sysusers u
    where
        o.type in ('U','V','S')
    and (@table_schema is null or @table_schema = user_name(o.uid))
    and (@grantee is null or @grantee = user_name(u.uid))
    and p.id = o.id
    and     (@grantor is null or @grantor = user_name(p.grantor))
            /* expand groups */
    and     ((p.uid = u.uid and u.uid <> u.gid) or (p.uid = u.gid and u.uid <> u.gid))
    and     p.protecttype <> 206    /* only grant rows */
    and     p.action in (26,193,195,196,197)
    and     o.uid <> u.uid          /* no rows for owner */
    and     not exists (            /* exclude revoke'd privileges */
            select  *
            from    sysprotects p1
            where   p1.protecttype = 206
            and     p1.action = p.action
            and     p1.id = p.id
            and     p1.uid = u.uid)
    union
    select  /*  Add rows for table owner */
        GRANTOR     = user_name(u.uid),
        GRANTEE     = user_name(o.uid),
        TABLE_CATALOG   = db_name(),
        TABLE_SCHEMA    = user_name(o.uid),
        TABLE_NAME  = o.name,
        PRIVILEGE_TYPE  = convert(varchar(30),
                    case v.number
                    when 193 then 'SELECT'
                    when 195 then 'INSERT'
                    when 196 then 'DELETE'
                    when 197 then 'UPDATE'
                    else 'REFERENCES'
                    end),
        IS_GRANTABLE    = convert(bit,1)    
    from 
        sysobjects o, master.dbo.spt_values v, sysusers u
    where
        o.type in ('U','V','S')
    and (@table_schema is null or @table_schema = user_name(o.uid))
    and (@grantee is null or @grantee = user_name(o.uid))
    and     u.uid = 1       /* grantor is dbo of database */
    and (@grantor is null or @grantor = user_name(u.uid))
    and     v.type = 'P'    /* cross product to get all exposed privileges */
    and     v.number in (26,193,195,196,197)
    and     not exists (    /* exclude revoke'd privileges */
            select  *
            from    sysprotects p1
            where   p1.protecttype = 206
            and     p1.action = v.number
            and     p1.id = o.id
            and     p1.uid = o.uid)
    order by 4,5,6,1,2
    END

exec @ret = sp_cursoropen @handle output, 'select * from #sptprivsrowset1',
    @scrollopt output, @ccopt output, @rows output

drop table #sptprivsrowset1
return isnull(@ret,0)
go
dump tran master with no_log
go
CREATE PROCEDURE sp_table_privileges_rowset;3
as
    select
        GRANTOR     = convert(sysname, ' '),
        GRANTEE     = convert(sysname, ' '),
        TABLE_CATALOG   = convert(sysname, ' '),
        TABLE_SCHEMA    = convert(sysname, ' '),
        TABLE_NAME  = convert(sysname, ' '),
        PRIVILEGE_TYPE  = convert(varchar(30), ' '),
        IS_GRANTABLE    = convert(bit, 0)
    where   1=0
go

if (charindex('7.00', @@version) = 0 and
    charindex('8.00', @@version) = 0)
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.0 SQL Server.'
    print 'Ignore the following errors.'
end
else
    drop proc sp_table_privileges_rowset
go


/*  Procedure for 8.0 server */
CREATE PROCEDURE sp_table_privileges_rowset
    (
    @table_name         sysname,
    @table_schema       sysname = null,
    @grantor        sysname = null,
    @grantee        sysname = null
    )
as
    select
        GRANTOR     = user_name(p.grantor),
        GRANTEE     = user_name(u.uid),
        TABLE_CATALOG   = db_name(),
        TABLE_SCHEMA    = user_name(o.uid),
        TABLE_NAME  = o.name,
        PRIVILEGE_TYPE  = convert(nvarchar(30),
                    case p.action
                    when 193 then N'SELECT'
                    when 195 then N'INSERT'
                    when 196 then N'DELETE'
                    when 197 then N'UPDATE'
                    else N'REFERENCES'
                    end),
        IS_GRANTABLE    = convert(bit,case when p.protecttype = 205 then 0 else 1 end)
    from 
        sysprotects p, sysobjects o, sysusers u, sysmembers m
    where
        o.name = @table_name
    and (@table_schema is null or @table_schema = user_name(o.uid))
    and (@grantee is null or @grantee = user_name(u.uid))
    and     o.type in ('U','V','S')
    and p.id = o.id
    and     (@grantor is null or @grantor = user_name(p.grantor))
        /* expand groups - AKUNDONE: only 1 level of grp unrolling. */
    and     (u.uid > 0 and u.uid < 16384)
    and     ((p.uid = u.uid) or (p.uid = m.groupuid and u.uid = m.memberuid))
    and     p.protecttype <> 206    /* only grant rows */
    and     p.action in (26,193,195,196,197)
    and     o.uid <> u.uid          /* no rows for owner */
    and     not exists (            /* exclude revoke'd privileges */
            select  *
            from    sysprotects p1
            where   p1.protecttype = 206
            and     p1.action = p.action
            and     p1.id = p.id
            and     p1.uid = u.uid)
    union
    select  /*  Add rows for table owner */
        GRANTOR     = user_name(u.uid),
        GRANTEE     = user_name(o.uid),
        TABLE_CATALOG   = db_name(),
        TABLE_SCHEMA    = user_name(o.uid),
        TABLE_NAME  = o.name,
        PRIVILEGE_TYPE  = convert(nvarchar(30),
                    case v.number
                    when 193 then N'SELECT'
                    when 195 then N'INSERT'
                    when 196 then N'DELETE'
                    when 197 then N'UPDATE'
                    else N'REFERENCES'
                    end),
        IS_GRANTABLE    = convert(bit,1)    
    from 
        sysobjects o, master.dbo.spt_values v, sysusers u
    where
        o.name = @table_name
    and (@table_schema is null or @table_schema = user_name(o.uid))
    and (@grantee is null or @grantee = user_name(o.uid))
    and     o.type in ('U','V','S')
    and     u.uid = 1       /* grantor is dbo of database */
    and (@grantor is null or @grantor = user_name(u.uid))
    and     v.type = 'P'    /* cross product to get all exposed privileges */
    and     v.number in (26,193,195,196,197)
    and     not exists (    /* exclude revoke'd privileges */
            select  *
            from    sysprotects p1
            where   p1.protecttype = 206
            and     p1.action = v.number
            and     p1.id = o.id
            and     p1.uid = o.uid)
    order by 4,5,6,1,2
go
dump tran master with no_log
go
CREATE PROCEDURE sp_table_privileges_rowset;2
    (
    @table_schema       sysname = null,
    @grantor        sysname = null,
    @grantee        sysname = null
    )
as
    select
        GRANTOR     = user_name(p.grantor),
        GRANTEE     = user_name(u.uid),
        TABLE_CATALOG   = db_name(),
        TABLE_SCHEMA    = user_name(o.uid),
        TABLE_NAME  = o.name,
        PRIVILEGE_TYPE  = convert(nvarchar(30),
                    case p.action
                    when 193 then N'SELECT'
                    when 195 then N'INSERT'
                    when 196 then N'DELETE'
                    when 197 then N'UPDATE'
                    else N'REFERENCES'
                    end),
        IS_GRANTABLE    = convert(bit,case when p.protecttype = 205 then 0 else 1 end)
    from 
        sysprotects p, sysobjects o, sysusers u, sysmembers m
    where
        o.type in ('U','V','S')
    and (@table_schema is null or @table_schema = user_name(o.uid))
    and (@grantee is null or @grantee = user_name(u.uid))
    and p.id = o.id
    and     (@grantor is null or @grantor = user_name(p.grantor))
        /* expand groups - AKUNDONE: only 1 level of grp unrolling. */
    and     (u.uid > 0 and u.uid < 16384)
    and     ((p.uid = u.uid) or (p.uid = m.groupuid and u.uid = m.memberuid))
    and     p.protecttype <> 206    /* only grant rows */
    and     p.action in (26,193,195,196,197)
    and     o.uid <> u.uid          /* no rows for owner */
    and     not exists (            /* exclude revoke'd privileges */
            select  *
            from    sysprotects p1
            where   p1.protecttype = 206
            and     p1.action = p.action
            and     p1.id = p.id
            and     p1.uid = u.uid)
    union
    select  /*  Add rows for table owner */
        GRANTOR     = user_name(u.uid),
        GRANTEE     = user_name(o.uid),
        TABLE_CATALOG   = db_name(),
        TABLE_SCHEMA    = user_name(o.uid),
        TABLE_NAME  = o.name,
        PRIVILEGE_TYPE  = convert(nvarchar(30),
                    case v.number
                    when 193 then N'SELECT'
                    when 195 then N'INSERT'
                    when 196 then N'DELETE'
                    when 197 then N'UPDATE'
                    else N'REFERENCES'
                    end),
        IS_GRANTABLE    = convert(bit,1)    
    from 
        sysobjects o, master.dbo.spt_values v, sysusers u
    where
        o.type in ('U','V','S')
    and (@table_schema is null or @table_schema = user_name(o.uid))
    and (@grantee is null or @grantee = user_name(o.uid))
    and     u.uid = 1       /* grantor is dbo of database */
    and (@grantor is null or @grantor = user_name(u.uid))
    and     v.type = 'P'    /* cross product to get all exposed privileges */
    and     v.number in (26,193,195,196,197)
    and     not exists (    /* exclude revoke'd privileges */
            select  *
            from    sysprotects p1
            where   p1.protecttype = 206
            and     p1.action = v.number
            and     p1.id = o.id
            and     p1.uid = o.uid)
    order by 4,5,6,1,2
go
dump tran master with no_log
go
create procedure sp_table_privileges_rowset;5
    (
    @table_server       sysname,
    @table_catalog      sysname = null,
    @table_name     sysname = null,
    @table_schema       sysname = null,
    @grantor        sysname = null,
    @grantee        sysname = null
    )
as
    select
        GRANTOR,        
        GRANTEE,        
        TABLE_CATALOG,  
        TABLE_SCHEMA,   
        TABLE_NAME, 
        PRIVILEGE_TYPE, 
        IS_GRANTABLE    
    from master.dbo.SYSREMOTE_TABLE_PRIVILEGES (
                @table_server,
                @table_catalog,
                @table_schema,
                @table_name,
                @grantor,
                @grantee )
    order by 3,4,5,6,1,2
go

grant execute on sp_table_privileges_rowset to public
go
dump tran master with no_log
go
if (charindex('6.00', @@version) > 0)
    begin
    if (exists (select * from sysobjects
        where name = 'sp_table_privileges_rowset' and type = 'P '))
        begin
        drop proc sp_table_privileges_rowset
        dump tran master with no_log
        end
    end
go


print ''
print 'creating sp_linkedservers_rowset'
go
if (charindex('7.00', @@version) = 0 and
    charindex('8.00', @@version) = 0)
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.0 SQL Server.'
    print 'Ignore the following errors.'
end
go
/*  Procedure for 8.0 server */
create proc sp_linkedservers_rowset
    (
    @srvname    sysname
    )
as
	select
		SVR_NAME 		    = srvname,
		SVR_PRODUCT		    = srvproduct,
		SVR_PROVIDERNAME	= providername,
		SVR_DATASOURCE		= datasource,
		SVR_PROVIDERSTRING  = case when is_srvrolemember('sysadmin') = 1 then providerstring else NULL end,
		SVR_LOCATION		= location,
		SVR_CATALOG		    = catalog
	from master.dbo.sysservers
	where srvname = @srvname and (srvstatus & 128) = 128
	order by 1
go
dump tran master with no_log
go
create proc sp_linkedservers_rowset;2
as
	select
		SVR_NAME 		    = srvname,
		SVR_PRODUCT		    = srvproduct,
		SVR_PROVIDERNAME	= providername,
		SVR_DATASOURCE		= datasource,
		SVR_PROVIDERSTRING  = case when is_srvrolemember('sysadmin') = 1 then providerstring else NULL end,
		SVR_LOCATION		= location,
		SVR_CATALOG		    = catalog
	from master.dbo.sysservers
	where (srvstatus & 128) = 128
	order by 1
go

grant execute on sp_linkedservers_rowset to public
go

dump tran master with no_log
go

print ''
print 'creating sp_table_statistics_rowset'
go
if (charindex('8.00', @@version) = 0)
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.00 SQL Server.'
    print 'Ignore the following errors.'
end
go
/*  Procedure for 8.00 server */
create proc sp_table_statistics_rowset
as
    select
        TABLE_CATALOG = convert(sysname, null),
        TABLE_SCHEMA = convert(sysname, null),
        TABLE_NAME = convert(sysname, null),
        STATISTICS_CATALOG = convert(sysname, null),
        STATISTICS_SCHEMA = convert(sysname, null),
        STATISTICS_NAME = convert(sysname, null),
        STATISTICS_TYPE = convert(smallint,0),
        COLUMN_NAME = convert(sysname, null),
        COLUMN_GUID = convert(uniqueidentifier, null),
        COLUMN_PROPID = convert(int, null),
        ORDINAL_POSITION = convert(int, null),
        SAMPLE_PCT = convert(smallint, null),
        LAST_UPDATE_TIME = convert(datetime, null),
        NO_OF_RANGES = convert(int, null),
        COLUMN_CARDINALITY = convert(bigint, null),
        TUPLE_CARDINALITY = convert(bigint, null),
        TABLE_CARDINALITY = convert(bigint, null),
        AVG_COLUMN_LENGTH = convert(int, null)
    where 1=0
go
dump tran master with no_log
go

create proc sp_table_statistics_rowset;2
                (@table_catalog     sysname = null,
                @table_schema       sysname = null,
                @table_name     sysname = null,
                @stat_catalog       sysname = null,
                @stat_schema        sysname = null,
                @stat_name      sysname = null)
as 
begin
    
    set nocount on

    -- check in parameters
    if ((@table_catalog is not null) and (db_name() <> @table_catalog)
        or (@stat_catalog is not null) and (db_name() <> @stat_catalog))
        begin   /* If qualifier doesn't match current database */
            raiserror 20001 '~~Rush_5~~'
            return
        end

    --- create temp table
    create table #spstattab(
        tblcatalog  sysname collate database_default not null,
        tblschema   sysname collate database_default not null,
        tblname     sysname collate database_default not null,
        statname    sysname collate database_default not null
        )

    insert into #spstattab
    select 
        db_name(),
        user_name(o.uid),
        o.name,
        x.name
    from sysobjects o, sysindexes x
    where o.type in ('U')
        and (@table_name is null or o.name = @table_name)
        and (@table_schema is null or @table_schema = user_name(o.uid))
        and (@stat_name is null or @stat_name = x.name)
        and (@stat_schema is null or @stat_schema = user_name(o.uid))
        and x.id = o.id
        and permissions(o.id) <> 0
        and x.statblob is not null
    order by 1,2,3,4

    -- fast forward CURSOR OVER THE temp TABLE
    declare ff_csr  cursor fast_forward for
    select tblcatalog, tblschema, tblname, statname from #spstattab

    declare @tblcatalog sysname,
        @tblschema  sysname,
        @tblname    sysname,
        @statname   sysname,
        @qtbl       nvarchar(4000),
        @rowsetcount    int

    set @rowsetcount = 0

    open ff_csr
    fetch ff_csr into @tblcatalog, @tblschema, @tblname, @statname
    while @@fetch_status >= 0
    begin
        set @rowsetcount = @rowsetcount + 1
        set @qtbl = @tblcatalog + '.' + @tblschema + '.' + @tblname
        dbcc show_statistics(@qtbl, @statname) with stat_header join density_vector
        fetch ff_csr into @tblcatalog, @tblschema, @tblname, @statname
    end
    close ff_csr
    deallocate ff_csr
    
    --- drop temp table
    drop table #spstattab

    if @rowsetcount = 0
    begin
        select  
            TABLE_CATALOG = convert(sysname, null),
            TABLE_SCHEMA = convert(sysname, null),
            TABLE_NAME = convert(sysname, null),
            STATISTICS_CATALOG = convert(sysname, null),
            STATISTICS_SCHEMA = convert(sysname, null),
            STATISTICS_NAME = convert(sysname, null),
            STATISTICS_TYPE = convert(smallint,0),
            COLUMN_NAME = convert(sysname, null),
            COLUMN_GUID = convert(uniqueidentifier, null),
            COLUMN_PROPID = convert(int, null),
            ORDINAL_POSITION = convert(int, null),
            SAMPLE_PCT = convert(smallint, null),
            LAST_UPDATE_TIME = convert(datetime, null),
            NO_OF_RANGES = convert(int, null),
            COLUMN_CARDINALITY = convert(bigint, null),
            TUPLE_CARDINALITY = convert(bigint, null),
            TABLE_CARDINALITY = convert(bigint, null),
            AVG_COLUMN_LENGTH = convert(int, null)
        where 1=0
    end

    set nocount off
end
go

grant execute on sp_table_statistics_rowset to public
go

dump tran master with no_log
go

print ''
print 'creating sp_oledb_column_constraints'
go

/* Procedure for 6.5 server */
create procedure sp_oledb_column_constraints
    (@tblname varchar(225)      -- the table to check for constraints
    ,@colname varchar(225)      -- the column to check for constraints
    ,@dropcnst smallint)
as
begin
    -- PRELIM
    set nocount on

    declare @tblid      int           -- the object id of the table
        ,@cnstname      varchar(225)   -- name of const. currently under consideration
        ,@cnstid        int
        ,@cnstatus      int
        ,@dbname        varchar(30)

    -- Create temp table
    create table #spcnsttab
    (cnst_name      varchar(225)        NOT NULL)

    -- Check to see that the object names are local to the current database.
    if @tblname like '%.%.%'
       and  substring(@tblname, 1, charindex('.', @tblname) - 1) <> db_name()
    begin
        raiserror(15250,-1,-1)
        return (1)
    end
    -- Check to see if the table exists and initialize @objid.
    select @tblid = object_id(@tblname)
    if @tblid is NULL
    begin
        select @dbname=db_name()
        raiserror(15009,-1,-1,@tblname,@dbname)
        return (1)
    end

    -- STATIC CURSOR OVER THE TABLE'S CONSTRAINTS
    declare cnst_csr insensitive cursor for
        select c.constid, c.status, o.name 
        from sysconstraints c, sysobjects o 
        where c.id = @tblid and o.id = c.constid
            and ((c.status & 0xf)=1 and (@dropcnst & 16)<> 0
            or (c.status & 0xf)=2 and (@dropcnst & 32)<> 0 
            or (c.status & 0xf)=5 and (@dropcnst & 2)<> 0)  
        -- ONLY 6.5 sysconstraints objects
        for read only

    -- Now check out each constraint, figure out its type and keys and
    -- save the info in a temporary table that we'll print out at the end.
    open cnst_csr
    fetch cnst_csr into @cnstid, @cnstatus, @cnstname
    while @@fetch_status >= 0
    begin
        if ((@cnstatus & 0xf) in (1, 2)) ---- primary key, unique
            begin
                -- get indid
                declare @indid smallint
                select  @indid = indid
                from    sysindexes
                where   name = object_name(@cnstid) and id = @tblid

                if (@colname = index_col(@tblname, @indid, 1)) 
                    and (index_col(@tblname, @indid, 2) is null)
                    begin
                        -- ADD TO TABLE
                        insert into #spcnsttab
                        values (@cnstname)
                    end
            end
        else
        if (@cnstatus & 0xf) = 5
            begin
                if (select col_name(id, colid) from sysconstraints where colid > 0 and constid=@cnstid) = @colname
                    begin
                        insert into #spcnsttab
                        values (@cnstname)
                    end
            end

        fetch cnst_csr into @cnstid ,@cnstatus ,@cnstname
    end     --of major loop
    close cnst_csr
    deallocate cnst_csr

    -- Now print out the contents of the temporary index table.
    select 'constraint_name' = cnst_name
    from #spcnsttab 
    
    drop table #spcnsttab

    set nocount off
    return (0)
end 
go
dump tran master with no_log
go

if (charindex('7.00', @@version) = 0 and
    charindex('8.00', @@version) = 0)
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 7.0 SQL Server.'
    print 'Ignore the following errors.'
end
else
    drop proc sp_oledb_column_constraints
go

/* Procedure for 7.0 server */
create procedure sp_oledb_column_constraints
    (@tblname nvarchar(776)     -- the table to check for constraints
    ,@colname nvarchar(776)     -- the column to check for constraints
    ,@dropcnst smallint)
as
begin
    -- PRELIM
    set nocount on

    declare @tblid      int           -- the object id of the table
        ,@cnstname      sysname       -- name of const. currently under consideration
        ,@cnstid        int
        ,@cnsttype      character(2)
        ,@dbname        sysname

    -- Create temp table
    create table #spcnsttab
    (cnst_name      sysname     NOT NULL)

    -- Check to see that the object names are local to the current database.
    select @dbname = parsename(@tblname,3) 
    if @dbname is not null and @dbname <> db_name()
    begin
        raiserror(15250,-1,-1)
        return (1)
    end

    -- Check to see if the table exists and initialize @objid.
    select @tblid = object_id(@tblname)
    if @tblid is NULL
    begin
        select @dbname=db_name()
        raiserror(15009,-1,-1,@tblname,@dbname)
        return (1)
    end

    -- STATIC CURSOR OVER THE TABLE'S CONSTRAINTS
    declare cnst_csr cursor fast_forward for
        select id, xtype, name 
        from sysobjects 
        where parent_obj = @tblid
            and ((xtype = 'PK' and (@dropcnst & 16)<> 0) 
            or (xtype = 'UQ' and (@dropcnst & 32)<> 0)
            or (xtype = 'D ' and (@dropcnst & 2)<> 0))  
        -- ONLY 6.5 sysconstraints objects
        for read only

    -- Now check out each constraint, figure out its type and keys and
    -- save the info in a temporary table that we'll print out at the end.
    open cnst_csr
    fetch cnst_csr into @cnstid, @cnsttype, @cnstname
    while @@fetch_status >= 0
    begin
        if @cnsttype in ('PK','UQ')
            begin
                -- get indid
                declare @indid smallint
                select  @indid = indid
                from    sysindexes
                where   name = object_name(@cnstid) and id = @tblid

                if (@colname = index_col(@tblname, @indid, 1)) 
                    and (index_col(@tblname, @indid, 2) is null)
                    begin
                        -- ADD TO TABLE
                        insert into #spcnsttab
                        values (@cnstname)
                    end
            end
        else
        if (@cnsttype = 'D ')
            begin
                if (select col_name(@tblid, info) from sysobjects where id=@cnstid) = @colname
                    begin
                        insert into #spcnsttab
                        values (@cnstname)
                    end
            end

        fetch cnst_csr into @cnstid ,@cnsttype ,@cnstname
    end     --of major loop
    close cnst_csr
    deallocate cnst_csr

    -- Now print out the contents of the temporary index table.
    select 'constraint_name' = cnst_name
    from #spcnsttab 

    drop table #spcnsttab
    
    set nocount off
    return (0)
end
go

if (charindex('8.00', @@version) = 0)
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.0 SQL Server.'
    print 'Ignore the following errors.'
end
else
    drop proc sp_oledb_column_constraints
go

/* Procedure for 8.0 server */
create procedure sp_oledb_column_constraints
    (@tblname nvarchar(776)     -- the table to check for constraints
    ,@colname nvarchar(776)     -- the column to check for constraints
    ,@dropcnst smallint)
as
begin
    -- PRELIM
    set nocount on

    declare @tblid      int           -- the object id of the table
        ,@cnstname      sysname       -- name of const. currently under consideration
        ,@cnstid        int
        ,@cnsttype      character(2)
        ,@dbname        sysname

    -- Create temp table
    create table #spcnsttab
    (cnst_name      sysname     collate database_default NOT NULL)

    -- Check to see that the object names are local to the current database.
    select @dbname = parsename(@tblname,3) 
    if @dbname is not null and @dbname <> db_name()
    begin
        raiserror(15250,-1,-1)
        return (1)
    end

    -- Check to see if the table exists and initialize @objid.
    select @tblid = object_id(@tblname)
    if @tblid is NULL
    begin
        select @dbname=db_name()
        raiserror(15009,-1,-1,@tblname,@dbname)
        return (1)
    end

    -- STATIC CURSOR OVER THE TABLE'S CONSTRAINTS
    declare cnst_csr cursor fast_forward for
        select id, xtype, name 
        from sysobjects 
        where parent_obj = @tblid
            and ((xtype = 'PK' and (@dropcnst & 16)<> 0) 
            or (xtype = 'UQ' and (@dropcnst & 32)<> 0)
            or (xtype = 'D ' and (@dropcnst & 2)<> 0))  
        -- ONLY 6.5 sysconstraints objects
        for read only

    -- Now check out each constraint, figure out its type and keys and
    -- save the info in a temporary table that we'll print out at the end.
    open cnst_csr
    fetch cnst_csr into @cnstid, @cnsttype, @cnstname
    while @@fetch_status >= 0
    begin
        if @cnsttype in ('PK','UQ')
            begin
                -- get indid
                declare @indid smallint
                select  @indid = indid
                from    sysindexes
                where   name = object_name(@cnstid) and id = @tblid

                if (@colname = index_col(@tblname, @indid, 1)) 
                    and (index_col(@tblname, @indid, 2) is null)
                    begin
                        -- ADD TO TABLE
                        insert into #spcnsttab
                        values (@cnstname)
                    end
            end
        else
        if (@cnsttype = 'D ')
            begin
                if (select col_name(@tblid, info) from sysobjects where id=@cnstid) = @colname
                    begin
                        insert into #spcnsttab
                        values (@cnstname)
                    end
            end

        fetch cnst_csr into @cnstid ,@cnsttype ,@cnstname
    end     --of major loop
    close cnst_csr
    deallocate cnst_csr

    -- Now print out the contents of the temporary index table.
    select 'constraint_name' = cnst_name
    from #spcnsttab 

    drop table #spcnsttab
    
    set nocount off
    return (0)
end
go

grant execute on sp_oledb_column_constraints to public
go

dump tran master with no_log
go

print ''
print 'creating sp_oledb_indexinfo'
go

/* Procedure for 6.5 server */
create procedure sp_oledb_indexinfo
        @objname varchar(225)       -- the table to check for indexes
        ,@indname varchar(225)
as
begin
    -- PRELIM
    set nocount on

    declare @objid int,         -- the object id of the table
        @indid smallint,    -- the index id of an index
        @status int,
        @dbname varchar(30),
        @OrigFillFactor tinyint,
        @i int, 
        @thiskey varchar(32),
        @tptr     varbinary(16) -- pointer for building text strings.
    ---- Check to see that the object names are local to the current database.
    if @objname like '%.%.%'
       and  substring(@objname, 1, charindex('.', @objname) - 1) <> db_name()
    begin
        raiserror(15250,-1,-1)
        return (1)
    end
    ---- Check to see if the table exists and initialize @objid.
    select @objid = object_id(@objname)
    ---- Table does not exist so return.
    if @objid is NULL
    begin
        select @dbname=db_name()
        raiserror(15009,-1,-1,@objname,@dbname)
        return (1)
    end

    select @indid = indid, @status = status, @OrigFillFactor = OrigFillFactor
    from sysindexes
    where id = @objid and name = @indname 

    -- IF NO INDEX, QUIT
    if @indid is NULL
    begin
        raiserror(15472,-1,-1) --'Object does not have any indexes.'
        return (1)
    end
    -- create temp table
    create table #spindtab
    (
        status              int,
        OrigFillFactor          tinyint,
        index_keys          text    NOT NULL,
    )
    -- Now check out each index, figure out its type and keys and
    -- First we'll figure out what the keys are.
    select @i = 1
    while (@i <= 16)
        begin
            select @thiskey = index_col(@objname, @indid, @i)
            if @thiskey is NULL
                    goto keysdone
            if @i=1
                begin
                    insert into #spindtab
                    values (@status, @OrigFillFactor, @thiskey)

            select @tptr = textptr(index_keys) from #spindtab
                end
            else
                begin
                    select @thiskey = ', ' + @thiskey

            if @tptr is not null
                    updatetext #spindtab.index_keys @tptr null null @thiskey
                end

        select @i = @i + 1
         end --loop 16
         ---- When we get here we now have all the keys.

keysdone:
    select * from #spindtab
    
    drop table #spindtab
    set nocount off
    return (0)
end
go
dump tran master with no_log
go

if (charindex('7.00', @@version) = 0 and
    charindex('8.00', @@version) = 0)
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.0 SQL Server.'
    print 'Ignore the following errors.'
end
else
    drop proc sp_oledb_indexinfo
go

/* Procedure for 8.0 server */
create proc sp_oledb_indexinfo
        @objname nvarchar(776)      -- the table to check for indexes
        ,@indname nvarchar(776)
as
begin
    -- PRELIM
    set nocount on

    declare @objid int,         -- the object id of the table
        @indid smallint,    -- the index id of an index
        @status int,
        @keys nvarchar(2078),-- string build index key list, length = (16*max_id_length)+(15*2)
        @dbname sysname,
        @OrigFillFactor tinyint

    -- Check to see that the object names are local to the current database.
    select @dbname = parsename(@objname,3) 

    if @dbname is not null and @dbname <> db_name()
    begin
            raiserror(15250,-1,-1)
            return (1)
    end

    -- Check to see the the table exists and initialize @objid.
    select @objid = object_id(@objname)
    if @objid is NULL
    begin
        select @dbname=db_name()
        raiserror(15009,-1,-1,@objname,@dbname)
        return (1)
    end

    select @indid = indid, @status = status, @OrigFillFactor = OrigFillFactor
    from sysindexes
    where id = @objid and name = @indname 

    -- IF NO INDEX, QUIT
    if @indid is NULL
    begin
        raiserror(15472,-1,-1) --'Object does not have any indexes.'
        return (1)
    end

    -- First we'll figure out what the keys are.
    declare @i int, @thiskey sysname
    select @keys = index_col(@objname, @indid, 1),
        @i = 2, @thiskey = index_col(@objname, @indid, 2)
    while (@thiskey is not null )
    begin
        select @keys = @keys + ', ' + @thiskey, @i = @i + 1
        select @thiskey = index_col(@objname, @indid, @i)
    end
    -- DISPLAY THE RESULTS
    select 'Status'=@status, 'OrigFillFactor' =@OrigFillFactor, 'Index keys'=@keys
    set nocount off
    return (0) 
end
go

grant execute on sp_oledb_indexinfo to public
go

dump tran master with no_log
go

print ''
print 'creating sp_oledb_ro_usrname'
go

create procedure sp_oledb_ro_usrname
as
begin
    select substring('NY',status/1024&1+1,1),user_name() 
    from master..sysdatabases 
    where name=DB_NAME()
end
go

grant execute on sp_oledb_ro_usrname to public
go

dump tran master with no_log
go

if (charindex('6.00', @@version) > 0 or
    charindex('6.50', @@version) > 0 or
    charindex('7.00', @@version) > 0)
    begin
    if (exists (select * from sysobjects
        where name = 'sp_oledb_ro_usrname' and type = 'P '))
        begin
            drop proc sp_oledb_ro_usrname
            dump tran master with no_log
        end
    end
go

print ''
print 'creating sp_oledb_deflang'
go

if (charindex('8.00', @@version) = 0)
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.0 SQL Server.'
    print 'Ignore the following errors.'
end
go

create procedure sp_oledb_deflang
as
    begin
        select ISNULL(language,'us_english') 
        from master..syslogins 
        where sid=SUSER_SID()
    end
go

grant execute on sp_oledb_deflang to public
go

dump tran master with no_log
go

if (charindex('6.00', @@version) > 0 or
    charindex('6.50', @@version) > 0 or
    charindex('7.00', @@version) > 0)
    begin
    if (exists (select * from sysobjects
        where name = 'sp_oledb_deflang' and type = 'P '))
        begin
            drop proc sp_oledb_deflang
            dump tran master with no_log
        end
    end
go

print ''
print 'creating sp_oledb_defdb'
go

if (charindex('8.00', @@version) = 0)
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.0 SQL Server.'
    print 'Ignore the following errors.'
end
go

create procedure sp_oledb_defdb
as
    begin
        select dbname from master..syslogins where sid=SUSER_SID()
    end
go

grant execute on sp_oledb_defdb to public
go

dump tran master with no_log
go

if (charindex('6.00', @@version) > 0 or
    charindex('6.50', @@version) > 0 or
    charindex('7.00', @@version) > 0)
    begin
    if (exists (select * from sysobjects
        where name = 'sp_oledb_defdb' and type = 'P '))
        begin
            drop proc sp_oledb_defdb
            dump tran master with no_log
        end
    end
go

print ''
print 'creating sp_oledb_database'
go

create procedure sp_oledb_database
as
    begin
        select name from master..sysdatabases
    end
go

grant execute on sp_oledb_database to public
go

dump tran master with no_log
go

if (charindex('6.00', @@version) > 0 or
    charindex('6.50', @@version) > 0 or
    charindex('7.00', @@version) > 0)
    begin
    if (exists (select * from sysobjects
        where name = 'sp_oledb_database' and type = 'P '))
        begin
            drop proc sp_oledb_database
            dump tran master with no_log
        end
    end
go

print ''
print 'creating sp_oledb_language'
go

create procedure sp_oledb_language
as
begin
    select 'English','us_english' 
    union 
    select alias,name from master..syslanguages
end
go

grant execute on sp_oledb_language to public
go

dump tran master with no_log
go
if (charindex('6.00', @@version) > 0 or
    charindex('6.50', @@version) > 0 or
    charindex('7.00', @@version) > 0)
    begin
    if (exists (select * from sysobjects
        where name = 'sp_oledb_language' and type = 'P '))
        begin
            drop proc sp_oledb_language
            dump tran master with no_log
        end
    end
go

/*---------------------------- END OLEDB CATALOG PROCS ------------------------*/


/*---------------------------- BEGIN BCP CATALOG PROCS ------------------------*/

print 'creating sp_tablecollations'
go

/* Used by BCP to gather all the collation names for a table */
if (charindex('8.00', @@version) = 0)
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.0 SQL Server.'
    print 'Ignore the following errors.'
end
go

/* Procedure for 8.0 server */
create procedure sp_tablecollations (@object nvarchar(4000))
as
begin
    select c.colid,
           c.name, 
           tds_collation = c.tdscollation,
           collation_name = BCPCollationName(c.tdscollation, c.xtype)
    from syscolumns c inner join sysobjects t on c.id = t.id
    where t.id = object_id(@object, 'local')
    order by c.colid
end
go

grant execute on sp_tablecollations to public
go

print 'creating sp_bcp_dbcmptlevel'
go

/* Used by BCP to get current db compatibility level */
if (charindex('8.00', @@version) = 0)
begin
    print ''
    print ''
    print 'Warning:'
    print 'you are installing the stored procedures '
    print 'on a pre 8.0 SQL Server.'
    print 'Ignore the following errors.'
end
go

/* Procedure for 8.0 server */
create procedure sp_bcp_dbcmptlevel (@dbname sysname)
as
begin
    select cmptlevel
    from master.dbo.sysdatabases
    where name = @dbname
end
go

grant execute on sp_bcp_dbcmptlevel to public
go

/*---------------------------- END BCP CATALOG PROCS ------------------------*/

dump tran master with no_log
go




if (exists (select * from sysobjects
        where name = 'sp_configure' and type = 'P '))
    begin
        exec sp_configure 'allow updates',0
        reconfigure with override
    end
go

exec sp_MS_upd_sysobj_category 2 /* set category | 2 based on crdate. */

go

if exists (select * from sysobjects where name = 'sp_check_objects'
            and type = 'P ')
    begin
        /* Only supported on 6.0 servers */
        print ''
        print 'Checking objects created by instcat.sql.'

        exec sp_check_objects 'catalog'
    end
go

print ''
print 'instcat.sql completed successfully.'
go

set quoted_identifier off
go

dump tran master with no_log
go
checkpoint
go
/**/
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  MZ                @                                       	!L!This program cannot be run in DOS mode.
$       rI'''	('&'	z'uG'	x'	{'	y'	G'	}'Rich'                        PE  L DH         !
 X  d     k     p   \                                             d Q  0L                         *  p                             H  @           h  pK @                   .text   W     X                   `.data   5   p     \             @  .rsrc           x             @  @.reloc  9     :   l             @  BHp   ,H{   H   H   H   H   H   ,H  ,H{   H   H   H   )H           msvcrt.dll ntdll.dll COMCTL32.dll SHLWAPI.dll ADVAPI32.dll USER32.dll GDI32.dll KERNEL32.dll ole32.dll SHELL32.dll SAMLIB.dll WINSTA.dll                                                                                                                        0mw8w~RwKwuKwywyw{wUwLwrwBxwzw3w 4w,4w4wrwOwjwwNwMww{Uw`www-wwwewwIwfwbow5owow|ww|www{ywlwjww~wWwwow6yw\w\ww\^w>Swlw    V~=w[>wR>w@=w    kwwp[www_nwiZw_wwaw^w    ||||j>|I||||0|{|\||q|%x||5|||Y|G|%|$||c|.||1|
||||9|n||K|e||0%||F$|q|g|K|so||sV|I|#|u||||&|&||`|||X||||u|(| ||||||6#||||Q||p|||{|*|    (;qq@qqq,<qL:q:q8q    [|    Awzwwjwwpwow_w|~wSgwywEw    VB~A~A~B~B~B~ZB~A~nCB~B~B~B~lsB~;A~A~$tB~A~A~4eF~B~A~A~{B~B~iA~0B~A~6A~IB~CB~MB~B~B~B~B~MB~B~F~NJB~B~GB~sB~B~    6v    'MMMa~MMkMMMMMQNMwM~MjM~M/Mm&M\M#MgMMMMM
MMM    P|`|p||M|,|X|u||`||0||||N| ||+|@|]||    FOw{Ow~Pw                RH       #     |  RestoreSnapshot CreateSnapshot  S E C U R I T Y _ R e s t o r e     S Y S T E M _ R e s t o r e     S A M _ R e s t o r e   D e f a u l t P a s s w o r d   $ m a c h i n e . a c c     D R M D a t a   W P A   S y s t e m \ W P A         S y s t e m \ C u r r e n t C o n t r o l S e t \ C o n t r o l \ S e s s i o n   M a n a g e r \ W P A         M i c r o s o f t \ W i n d o w s \ C u r r e n t V e r s i o n \ P o l i c i e s \ R a t i n g s       M i c r o s o f t \ W i n d o w s \ C u r r e n t V e r s i o n \ H i n t s     M i c r o s o f t \ R e m o t e   D e s k t o p         C L S I D \ { 3 D A 1 6 5 B 6 - C C 4 1 - 1 1 d 2 - B D C 6 - 0 0 C 0 4 F 7 9 E C 6 B }         C L S I D \ { 8 D 8 7 6 3 A B - E 9 3 B - 4 8 1 2 - 9 6 4 E - F 0 4 E 0 0 0 8 F D 5 0 }     _ R e g R e p l a c e B a k     _ P e r R e s t o r e C o p y   S E C U R I T Y     S A M   S O F T W A R E     S Y S T E M     _ R E G I S T R Y _ M A C H I N E _     _ R E G I S T R Y _ U S E R _   S R T M C o m p r e s s S t o p     S R T M C o m p r e s s S t a r t   S R T M D i s a b l e   S R T M E n a b l e     S R T M F i f o S t o p     S R T M F i f o S t a r t   S R T M F i f o     S R T M T h a w     S R T M F r e e z e     c a t s r v u t . d l l     P e n d i n g F i l e R e n a m e O p e r a t i o n s   S y s t e m \ C u r r e n t C o n t r o l S e t \ C o n t r o l \ S e s s i o n   M a n a g e r     S y s t e m   C h e c k p o i n t   s r . m o f     f i l e l i s t . x m l     % S y s t e m R o o t % \ s y s t e m 3 2 \ r e s t o r e \     _ f i l e l s t . c f g     s r r p c   n c a l r p c   S R D a t a S t o r e   S R I d l e R e q E v e n t     S R S t o p E v e n t   S R I n i t E v e n t   S n a p s h o t C a l l b a c k s   C u r r e n t C o n t r o l S e t \ C o n t r o l \ S e s s i o n   M a n a g e r   R e s t o r e S a f e M o d e S t a t u s   R e s t o r e D i s k S p a c e E r r o r   S y s t e m R e s t o r e   R e s t o r e S t a t u s   C r e a t e F i r s t R u n R p     T e s t B r o a d c a s t   R e s t o r e I n P r o g r e s s   D e b u g B r e a k     T h a w I n t e r v a l     D i s k P e r c e n t   F i r s t R u n     S R S t a t u s     C o m p r e s s i o n B u r s t     T i m e r I n t e r v a l   R P L i f e I n t e r v a l     R P G l o b a l I n t e r v a l     R P S e s s i o n I n t e r v a l   D S M i n   D S M a x   D i s a b l e C o n f i g   D i s a b l e S R       S o f t w a r e \ P o l i c i e s \ M i c r o s o f t \ W i n d o w s   N T \ S y s t e m R e s t o r e         S y s t e m \ C u r r e n t C o n t r o l S e t \ S e r v i c e s \ S R \ P a r a m e t e r s   M a c h i n e G u i d   S y s t e m R e s t o r e S n a p s h o t       S o f t w a r e \ M i c r o s o f t \ W i n d o w s   N T \ C u r r e n t V e r s i o n \ S y s t e m R e s t o r e \ C f g     F i l e s T o S n a p s h o t   M i c r o s o f t \ W i n d o w s   N T \ C u r r e n t V e r s i o n \ S y s t e m R e s t o r e       S o f t w a r e \ M i c r o s o f t \ W i n d o w s   N T \ C u r r e n t V e r s i o n \ S y s t e m R e s t o r e     S y s t e m \ C u r r e n t C o n t r o l S e t \ S e r v i c e s \ S R S e r v i c e \ P a r a m e t e r s     S y s t e m \ C u r r e n t C o n t r o l S e t \ S e r v i c e s \ S R S e r v i c e   n t u s e r . d a t     P r o f i l e I m a g e P a t h         S o f t w a r e \ M i c r o s o f t \ W i n d o w s   N T \ C u r r e n t V e r s i o n \ P r o f i l e L i s t     U S E R S   H a r d w a r e     . _ s r     p a t o v e r   P a t c h W i n d o w   R e f R P   F i f o e d     R P     _ r e s t o r e     S y s t e m   V o l u m e   I n f o r m a t i o n   f i f o . l o g         c h a n g e . l o g .   c h a n g e . l o g     r p . l o g     S y s t e m   R e s t o r e   S e r v i c e     S R     S R S e r v i c e   \     - i       % S y s t e m R o o t % \ s y s t e m 3 2 \ r e s t o r e \ r s t r u i . e x e     * R e s t o r e       / d       c l e a n m g r . e x e     % w i n d i r % \ s y s t e m 3 2 \ c l e a n m g r . e x e     IsAdminUser = %d    ::CheckMembership failed - %ls  ::AllocateAndInitializeSid failed - %ls d:\xpsp\admin\pchealth\sr\rstrcore\api.cpp  IsAdminUser ::AdjustTokenPrivileges(RESTORE) failed - %ls   Privilege '%ls' does not exist, probably user is not an admin.  ::AdjustTokenPrivileges(ENABLE) failed - %ls    ::LookupPrivilegeValue failed - %ls ::OpenProcessToken failed - %ls CheckPrivilege  Cannot enable SE_SHUTDOWN_NAME privilege... S e S h u t d o w n P r i v i l e g e   Cannot enable SE_RESTORE_NAME privilege...  S e R e s t o r e P r i v i l e g e     Cannot enable SE_BACKUP_NAME privilege...   S e B a c k u p P r i v i l e g e   S e T a k e O w n e r s h i p P r i v i l e g e     Cannot enable SE_SECURITY_NAME privilege... CheckPrivilegesForRestore   S e S e c u r i t y P r i v i l e g e   ::CreateProcess failed - %ls    szCmdLine='%s'  ::GetFullPathName failed - %ls  InvokeDiskCleanup   Call to RA failed   Calling  RA to preserve state   ::SRSetRestorePoint failed, nStatus=%d  InitiateRestore     S o f t w a r e \ M i c r o s o f t \ W i n d o w s \ C u r r e n t V e r s i o n \ R u n O n c e   RestoreInProgress is 0  ::SHDeleteValue failed - %ls    ::SHGetValue failed - %ls   ResumeRestore   \\ \\    Creating drive list failed  Insufficient memory...  Not an admin user   Invalid parameter, ppCtx is NULL.   PrepareRestore  d r i v e t a b l e . t x t     ::LoadImage failed - %ls    d:\xpsp\admin\pchealth\sr\rstrcore\drvtable.cpp CRstrDriveInfo::GetIcon Incomplete Write (size=%d, written=%d)...   ::WriteFile failed - %ls    CRstrDriveInfo::SaveToLog   % d % %   ( % d   M B )     P C H S h e l l   W i n d o w       % w i n d i r % \ s y s t e m 3 2 \ r e s t o r e \ r s t r u i . e x e     ::SRUpdateDriveTable failed - %ls   ::EnableSR failed - %ls ::DisableSR failed - %ls    CRstrDriveInfo::ApplyConfig d:\xpsp\admin\pchealth\sr\rstrcore\srshutil.h   CSRDynPtrArray::AddItem m_llDSMax: %I64d, Size: %I64d   ! GetDiskFreeSpaceEx : %ld  ! RegOpenKeyEx : %ld    CRstrDriveInfo::InitUsage   ::GetVolumeInformation failed - %ls ::GetVolumePathNamesForVolumeName failed - %ls  CRstrDriveInfo::Init    Cannot read drive mount point...    Drive Guid is empty...  Cannot read drive ID... Unexpected EOF (size=%d, read=%d)...    ::ReadFile failed - %ls CRstrDriveInfo::LoadFromLog Status has been updated, m_dwFlags=%08X CRstrDriveInfo::UpdateStatus    CDriveTable::RemoveDrivesFromTable failed - %ls   szDTFile: '%ls'   Cannot load a drive table - %ls Loading drive table - %ls   ::CreateFile(volume) failed - %ls   Volume too small, excluded  Non-fixed drive   Mount=%ls Guid=%ls    ::FindFirstVolume failed - %ls  EnumVolumes Invalid parameter, ppRDI is NULL.   CreateAndLoadDriveInfoInstance  mount point too long %ls    Drive: %ls %ls  LoadDriveTable  UpdateDriveTable    CRestorePointEnum::FindNextRestorePoint failed - %ls    RPNum=%d    CRestorePointEnum::FindFirstRestorePoint failed - %ls   Loading current drive table failed  SR is DISABLED!!!   Cannot get disable reg key  SystemDrive=%ls Cannot get system drive - %ls   CreateDriveList     % S y s t e m R o o t % \ s y s t e m 3 2 \ r e s t o r e \ r s t r l o g . d a t   ::ExpandEnvironmentString failed - %ls  d:\xpsp\admin\pchealth\sr\rstrcore\logfile.cpp  CRestoreLogFile::Init   Invalid restore log file header signature...    ::CreateFile failed - %ls   File is already opened...   CRestoreLogFile::Open   File is not opened...   % s \ % s   ! SRMemAlloc for pBuf   CRestoreLogFile::WriteEntry CRestoreLogFile::WriteCollisionEntry    CRestoreLogFile::WriteMarker    Invalid parameter, ppLogFile is NULL.   OpenRestoreLogFile  CRestoreLogFile::ReadHeader CreateRestoreLogFile    ~\\\~\\/\~\\\k\\\\\\~\\=\\\\k\\\no \ in the string  no second \ in the string   Acl file is %S  d:\xpsp\admin\pchealth\sr\rstrcore\mapentry.cpp GetDSRelativeFileName   ~\\\Null ACL... BAD SD FORMAT...        Src=%ls ::SetFileSecurity failed - %ls  ::GetFileSize failed - %ls      Acl=%ls SetAcl: Src=%ls, path=%ls, cbAcl=%d CRMESetAcl::Restore ~\\h\    Src=%ls, Attr=%08X  ::SetFileAttributes failed - %ls    SetAttrib: Src=%ls, Attr=%08X   CRMESetAttrib::Restore  ~\\\::DeleteVolumeMountPoint failed - '%ls' The file not found...   MountDelete: Src=%S alloca for size %d failed   CRMEMountDelete::Restore    ~\\k\CreateDirectory failed %S   MountDelete: Src=%S, Volume Name=%S CRMEMountCreate::Restore        To Src=%ls      From Dst=%ls    ::MoveFile failed - %ls RenameLockedObject      From Src=%ls to Dst=%ls ::MoveFileEx() failed - %ls CRestoreMapEntry::MoveFileDelay SRCreateSubdirectory failed - %ls   ! RenameLockedObject    Entry already exists, but is not a directory!!! The directory already exists... DirCreate: Src=%ls  CRMEDirCreate::Restore  ::RemoveDirectory failed - %ls  The directory not found...  DirDelete: Src=%ls  CRMEDirDelete::Restore      From Dst=%ls to Src=%ls     Dst=%ls The current directory not found...  DirRename: Src=%ls, Dst=%ls CRMEDirRename::Restore  Entry already exists!   FileCreate: Tmp=%ls FileCreate: Src=%ls CRMEFileCreate::Restore Processlocked: Alt=%ls  Processlocked: Tmp=%ls  Processlocked: Src=%ls  CRMEFileCreate::ProcessLocked   ::DeleteFile failed - '%ls' FileDelete: Src=%ls CRMEFileDelete::Restore FileModify: Tmp=%ls FileModify: Src=%ls CRMEFileModify::Restore ! FindFirstFile : %ld   ! MoveFile %ld: %S to %S    szAlt for unique shortname: %S  ! SRGetAltFileName  \ s r   Source filename same as dest's shortname    The target file already exists...   The current file not found...   FileRename: Dst=%ls FileRename: Src=%ls CRMEFileRename::Restore Invalid operation type - %d Filepath lengths too long   CreateRestoreMapEntry   d r i v e t a b l e . t x t     P l u g   &   P l a y   S e s s i o n   M a n a g e r   P e n d i n g   R e n a m e   O p e r a t i o n s   M o u n t   M a n a g e r   I n s t a l l e d   S e r v i c e s         S y s t e m \ C u r r e n t C o n t r o l S e t \ C o n t r o l \ T i m e Z o n e I n f o r m a t i o n         C u r r e n t C o n t r o l S e t \ C o n t r o l \ T i m e Z o n e I n f o r m a t i o n   A l l o w P r o t e c t e d R e n a m e s   S f c S c a n   M i c r o s o f t \ W i n d o w s   N T \ C u r r e n t V e r s i o n \ W i n l o g o n         M i c r o s o f t \ W i n d o w s \ C u r r e n t V e r s i o n \ R u n O n c e         % S y s t e m R o o t % \ s y s t e m 3 2 \ c a t r o o t \ { F 7 5 0 E 6 C 3 - 3 8 E E - 1 1 D 1 - 8 5 E 5 - 0 0 C 0 4 F C 2 9 5 E E } \ t i m e s t a m p       - b     - c   % S y s t e m R o o t % \ s y s t e m 3 2 \ r e s t o r e \ r s t r m a p . d a t   ::RegOpenKey failed - %ls   d:\xpsp\admin\pchealth\sr\rstrcore\romgr.cpp    RegDeleteKey of %S succeeded    RegDeleteKey of %S failed ec=%d. Not an error.  DeleteRegKey    Successfully kept key %S    ::RegRestoreKey failed - %ls    ::RegCreateKeyEx failed - %ls   Current key %S did not exist. Leaving   Current DRM Key %S saved successfully   RegSaveKey of %S failed ec=%d   RegOpenKey of %S failed ec=%d   PersistRegKeys  % s % s \ % s . % s     \ s n a p s h o t   Old Key=%S, Value=%S    ! SRMemAlloc    SHGetValue failed - %ls New Key=%S, Value=%S    No value in %S  ValueReplace    RegQueryValueEx failed - %ls    Merge key - ignoring    Replacing key   Replacing value Key = %S    Name=%S     C u r r e n t C o n t r o l S e t \ C o n t r o l \ B a c k u p R e s t o r e \ K e y s N o t T o R e s t o r e     PreserveKeysNotToRestore    S y s t e m     %S -> %S    % s % s \ M F E X - % d . D A T     Src : %S, Dest : %S RestorePendingRenames   C l a s s e s \ % s     SRSetRegDword of safe mode status failed.ec=%d  Restore from safemode   SRSetRegDword failed.ec=%d  ::RegLoadKey failed - %ls   HandleSoftwareHive  RegisterNotificationDLL failed - %ls    ! SRSetRegMultiSz   ! malloc    RestoreMFE:%S, cbData2:%ld  Restore MFE entries exist   RestorePendingRenames failed - %ls  PersistRegKeys WPA New->New failed %d   PersistRegKeys WPA New->Old failed %d   HandleSystemHive    ::DeleteFile(timestamp) failed - %ls    S a m H i v e :     CSnapshot::GetSamHivePath failed - %ls  S y s H i v e :     CSnapshot::GetSystemHivePath failed - %ls   S W H i v e :       CSnapshot::GetSoftwareHivePath failed - %ls CRestoreOperationManager::T2HandleSnapshot  _wfopen failed on %s    % s - % s   :   F i f o e d   % s   o n   d r i v e   % s 
     a   Fifoed %S on drive %S   WriteFifoLog    Deleting files failed error %ld DeleteAllFilesBySuffix  % s \ % s *     SetRestoreStatusFailed  ::ExpandEnvironmentStrings failed - %s  CRestoreOperationManager::Init  FindNextChangeLogEntry failed - %ls FindFirstChangeLogEntry failed - %ls    Drive #%d: Drv='%ls', DS='%ls'  CRestoreOperationManager::T2CreateMap   D e l n o d e _ R e c u r s e   ! MoveFile from %S to %S : %ld  Delnode_Recurse No more rps to fifo Target restore point reached    R P 0   ! FindSystemDrive   ! %s : %ld  L o a d D r i v e T a b l e     CRestoreOperationManager::T2Fifo       New=%ls     Src=%ls  ::MoveFile failed - %s  Fatal failure, initiating Undo...   Failure detected, initiating Undo...    ***Initiating Undo***   g_dwExistingMFEXMarker = %ld    Restore failed agin because of Disk full. Setting Error Disk full, initiating fifo to clean up memory...    Res=%d, Err=%d  ***Still less than 60MB free*** ! T2Fifo : %ld - ignoring   ***Less than 60MB free - initiating fifo*** ! GetDiskFreeSpaceEx : %ld - ignoring   . C A T     C a t R o o t   ! GetVolumeInformation : %ld    Ignoring ACL change on non-NTFS drive   CRestoreOperationManager::T2DoRestore   D e l e t i n g   c h a n g e l o g s   f r o m     % s \ % s % d   ::SrStopMonitoring failed - %ls ::SrCreateControlHandle failed again - %d   ::SrCreateControlHandle failed - %d CRestoreOperationManager::T2UndoForFail Invalid parameter, ppROMgr is NULL. CreateRestoreOperationManager   cSS.InitResourceSnapshot failed - %ls   ! PatchReconstructOriginal : %ld    CRestoreOperationManager::ROThreadProc  % s % d     Timeout while waiting for the restore thread finishes...    ::WaitForSingleObject failed - %ls  ::CreateThread failed - %ls CRestoreOperationManager::Run   N o t i f i c a t i o n   P a c k a g e s   C u r r e n t C o n t r o l S e t \ C o n t r o l \ L s a   S y s t e m \ C u r r e n t C o n t r o l S e t \ C o n t r o l \ L s a     ! SamSetNextAvailableRid : %ld  ! SamGetNextAvailableRid : %ld  ! RegOpenKeyW on %S: %ld    ! RegLoadKeyW : %ld d:\xpsp\admin\pchealth\sr\rstrcore\password.cpp RestoreRIDs ! RegUnLoadKeyW 0n %S : %ld ! RestoreLsaSecrets : %ld   ! ForAllUsers : %ld ! RegLoadKeyW on %S: %ld    ! GetCurrentRestorePoint : %ld  ! GetSystemDrive : %ld  ! RtlAdjustPrivilege : %ld  RestorePasswords    \ S A M _ S E R V I C E _ S T A R T E D     ::SendMessage failed - %ls  d:\xpsp\admin\pchealth\sr\rstrcore\progress.cpp CRestoreProgressWindow::Create  ::SetDlgItemText failed - %ls   ::LoadString(%u) failed - %ls   Unknown Stage constant - %u CRestoreProgressWindow::SetStage    INTERNAL: m_dwPosLog(%u) is bigger than m_dwBase(%u)    m_dwStage(%u) is not Prepare or Restore...  CRestoreProgressWindow::Increment   ::InitCommonControlsEx failed - %ls CRestoreProgressWindow::Init    ::LoadImage(%d) failed - %ls    ::CreateCompatibleDC(NULL) failed - %ls CRestoreProgressWindow::LoadAndSetBrandBitmap   ::DestroyWindow failed - %ls    CRestoreProgressWindow::RPWDlgProc  Internal mismatch - hWnd=%08X, m_hWnd=%08X  ::CreateDialogParam failed - %ls    Invalid parameter, ppProgWnd is NULL.   CreateRestoreProgressWindow d:\xpsp\admin\pchealth\sr\rstrcore\srshutil.cpp ReadStrAlign4   ::FormatMessage failed - %ls    SRFormatMessage ShowSRErrDlg    SRGetRegDword   ::SHSetValue failed - %ls   SRSetRegDword   SRSetRegStr CSRStr::SetStr(LPCWSTR,int) Executable does not exist - '%ls'   ::LoadLibrary() failed - %ls    L o a d F i l e L i s t     Object does not exist - '%ls'       cszPath='%ls'   ::CreateFile() failed - %ls CSRLockFile::CSRLockFile()      S o f t w a r e \ M i c r o s o f t \ W i n d o w s   N T \ C u r r e n t V e r s i o n \ S y s t e m R e s t o r e \ S h e l l     L o c k F i l e L i s t     ::CloseHandle(m_aryLoad[%d]) failed - %ls   ::CloseHandle(m_aryLock[%d]) failed - %ls   CSRLockFile::~CSRLockFile   S R C o u n t e r     >    >    >            >     >     >          Group Policy disables SR configuration...   GetDlgItemText failed for IDC_DCU_HOWTO: %s o p e n         h c p : / / s e r v i c e s / s u b s i t e ? n o d e = T o p L e v e l B u c k e t _ 4 / F i x i n g _ a _ p r o b l e m & s e l e c t = T o p L e v e l B u c k e t _ 4 / F i x i n g _ a _ p r o b l e m / U s i n g _ S y s t e m _ R e s t o r e _ t o _ u n d o _ c h a n g e s   ! WinHelp : %ld d:\xpsp\admin\pchealth\sr\rstrcore\syscfg.cpp   SRCfgSingleDlgProc  s y s r e s t o r e . h l p     GetDlgItemText failed for IDC_NORMAL_DCU_HOWTO: %s  GetDlgItemText failed for IDC_SYSTEM_DCU_HOWTO: %s  SRCfgDriveSettingsDlgProc   SRCfgMultiDlgProc   % l s   ( % l s )   ::CreatePropertySheetPage failed - %ls  Drive List is empty...???   Group Policy disables SR... SRGetCplPropPage    SRRemoveRestorePoint    SRUpdateDSSize  SRSetRestorePointW  DisableSR   EnableFIFO  DisableFIFO EnableSR    EnableSREx  srclient.dll            n\    (o\Lo\        o\m_pCurrentRp = NULL CRestorePointEnum::FindNextRestorePoint ! FindFirstRestorePoint : %ld   m_pRestorePointEnum=NULL    CChangeLogEntryEnum::FindNextChangeLogEntry Cannot allocate memory for m_pCurrentRp Cannot allocate pFindData   CRestorePointEnum::FindFirstRestorePoint    Out of memory   ! m_DSLock.Init : %ld   CChangeLogEntryEnum::FindFirstChangeLogEntry    \ R e s t o r e P o i n t S i z e   ! CreateFile on %S : %ld    ! ReadFile on %S : %ld  SRMemAlloc failed   CRestorePoint::ReadLog  Zero sized log : %ld    ! LogHeader for %S : invalid or corrupt ! Readfile: ToRead=%ld, Read=%ld bytes  No more entries Readfile could not read a DWORD End of file ReadFile failed, error=%ld  Change log %S not owned by admin or system  CChangeLogEntry::BuildList  BuildList : error=%ld   No more change logs Enumerating %S in %S    CRestorePoint::FindNextChangeLogEntry   ! BuildList : %ld   No changelog in %S  CRestorePoint::FindFirstChangeLogEntry  % s % 0 7 d % s     % s % d % s     % s * % s   RegDBRestore    RegDBBackup \ R e g i s t r y \ M a c h i n e \     R e s t o r e 1 2 2 3 1 2   S y s t e m \ C u r r e n t C o n t r o l S e t \ C o n t r o l \ H i v e l i s t   . D E F A U L T     _ C l a s s e s     N T U S E R _   U S R C L A S S _   L o c a l   S e t t i n g s \ A p p l i c a t i o n   D a t a \ M i c r o s o f t \ W i n d o w s \ U s r C l a s s . d a t     % w i n d i r % \ s y s t e m 3 2 \ i n e t s r v \ m e t a b a s e . b i n     % w i n d i r % \ s y s t e m 3 2 \ i n e t s r v \ m e t a b a c k \   . M D   I I S D B   R e p o s i t o r y     C o m D b . D a t   F i l e   w a s     RegSaveKey failed for %S, error %ld Key %S did not exist, error %ld RegCreateKeyEx failed for %S, error %ld SaveRegKey  % s \ % s % s % s   Insuffcient buffer. Buffer passed in %d, Required %d    CreateNTUserDatPath CreateUsrClassPath  No old MFE entries exist    Old MFE entries exist   %S  ! \ ? ? \ % s   \ ? ? \ % s     R e g O p e n K e y     R e g L o a d K e y     SrMoveFileEx    % s \ % s % s   CreateUsrDefaultPath    d s t =     s r c =     SRCopyFile failed. ec=%d    SetFileAttributes failed %d GetFileAttributes failed %d SnapshotCopyFile    UsrClass cannot be copied. ec=%d. Ignoring this error   Usrclass.dat deleted    ! DeleteFile on usrclass.dat    NTuser.dat deleted  ! DeleteFile on ntuser.dat : %ld    ExpandEnvironmentStrings failed for %S, ec=%d   Error %d in querying Profilepath of %S  Error %d in opening ProfileList of %S   CopyUserProfile % s % s     Error getting function RegDBRestore. ec=%d  LoadLibrary of %S failed ec=%d  CSnapshot::GetCOMplusRestoreFN  ! MoveFile : %ld    ! ExpandEnvironmentStrings : %ld    ! SnapshotCopyFile : %ld    IIS snapshot does not exist RestoreIISSnapshot  AdjustTokenPrivileges %ld   SetThreadToken failed ec=%d LookupPrivilegeValue failed ec=%d   DuplicateTokenEx failed ec=%d   OpenProcessToken failed ec=%d   GetCurrentProcess failed ec=%d  CSnapshot::SetPrivilegeInAccessToken    L a s t A l i v e S t a m p     B a c k u p E x e c R e g \ M i c r o s o f t \ W i n d o w s \ C u r r e n t V e r s i o n \ R e l i a b i l i t y     B a c k u p E x e c R e g   %S is already a backup file. Ignoring   CopyHKLMHiveForRestore  Error %d in opening base key %S Failed ::RegLoadKey('%S') ec=%d LoadTempHKLM    Failed to restore COM DB. hr=0x%x   CSnapshot::RestoreCOMDbSnapshot % s % s \ % s % s % s   C a n ' t   f i n d     CheckHKLM file Security failed ec=%d    CheckHKLM file SAM failed ec=%d CheckHKLM file System failed ec=%d  CheckHKLM file Software failed ec=%d    CheckforCriticalFiles   DeleteFile failed ec=%d DeleteTempRestoreFile   % s \ * % s     ! DeleteFile : %ld  DeleteReconstructedTempFile DeleteAllReconstructedFiles . l o g     Exception code=%d   MyExceptionFilter   Handled exception - continuing  An exception occurred when loading and executing %S ! LoadLibrary on %S : %ld   ! GetProcAddress : %ld  Dll: %S, Error:%ld - ignoring   No registered callbacks CallSnapshotCallbacks       \\        j\! SrMoveFileEx : %ld    Trying movefileex   *** RegReplaceKey failed for %S, error %ld  SetNewRegistry  Cannot allocate memory  SaveRegKey or SetNewRegistry failed ec=%d   ProcessUserRegKeys  Error processing default key ec=%d  Error %d saving key %S - ignoring   Trying registry APIs for  %S    CopyUserProfile for %S failed. Error %d Enumerated Key %S   RegOpenKeyEx failed for ProfileList, error %ld  ProcessHKUsersKey   DoHKUsersSnapshot failed error %ld  \ W b e m \ R e p o s i t o r y     ! CoInitializeEx : %ld  SetPrivilegeInAccessToken failed ec=%d  ! SRMoveFileEx : %ld    ! MoveFile : %ld trying SrMoveFileEx    CoCreateInstance failed ignoring %x Wbem Pause failed ignoring %x   . b a k     Failed CopyFile_Recurse. Ignoring error=0x%x    Failed to create WMI temp dir. Ignoring error=0x%x  RestoreWMISnapshot  \ W b e m \ R e p o s i t o r y . t m p     ! RegEnumValue : %ld    % s \ % s - % d     No filelist files to snapshot/restore   SnapshotFilesKey=%S S o f t w a r e     ! CallSnapshotCallbacks : %ld - ignoring    CallbacksKey=%S % s \ % s \ % s     SnapshotRestoreFilelistFiles    SetNewRegistry failed for %S, error %ld, file %S    RestoreHKLMHive ProcessGivenFiles failed error %ld  % s \ % s * % s     LoadTempHKLM failed CopyFile failed. ec=%d  % s . b a c k u p h i v e   CSnapshot::RestoreRegistrySnapshot  copying hives failed error %ld  CheckforCriticalFiles failed ec=%d  InitRestoreSnapshot srrstr!Restored FilelistFiles
  srrstr!Restored COMDb
  srrstr!Restored WMI
    srrstr!Restored IIS
    srrstr!Restored registry
   srrstr!Safe restore point %S
   srrstr!Safe snapshot directory does not exist!
 ! InitRestoreSnapshot   srrstr!GetCurrentRestorePoint failed!
  srrstr!Error in RestoreSnapshot
    *** Initiating UNDO for test purposes ***   D e b u g T e s t U n d o   Snapshot directory does not exist   CSnapshot::RestoreSnapshot  Initializing g_dwPatchWindow = %ld  d:\xpsp\admin\pchealth\sr\snapshot\snappatch.cpp    PatchGetPatchWindow Current Rp: %ld, Reference : %S RefRP does not exist either -- bailing    % s % l d     Original rp does not exist -- trying RefRP  PatchGetReferenceRpPath % s % l d   P a t c h G e t R e f e r e n c e R p P a t h   P a t c h G e t R p N u m b e r F r o m P a t h     No patching PatchReconstructOriginal    d r i v e t a b l e . t x t     removing %S from drivetable removedrivesfromtable   \ \ ? \ V o l u m e     ! CDataStore::GetVolumeInfo : %ld   CDataStore::GetVolumeInfo   . .     .   \ * . *     volume %S is active ! Mountpoint too long   ! Empty mountpoint  ! GetVolumePathNamesForVolumeNameW : %ld    CDataStore::IsVolumeDeleted             SRCLIENT.dll Z  \ F i l e S y s t e m \ F i l t e r s \ S y s t e m R e s t o r e   SrOpenPacket000 SetFileAttributes ignoring %ld  % S y s t e m D r i v e % \     % s % s \ % s   OpenService failed 0x%x OpenSCManager failed 0x%x   SetServiceStartup   ! QueryServiceConfig (first) : %ld  ! QueryServiceConfig (second) : %ld SR Service is not running   QueryServiceStatus failed 0x%x  IsSRServiceRunning  SR Service is running   IsSRServiceStopped  ControlService failed 0x%x  StopSRService   Cannot query secret %ws GetLsaSecret    Cannot set secret %ws   SetLsaSecret    File  exists    It is a Directory   GetFileAttributes failed 0x%x   Checking for %S DoesFileExist   SetSecurityInfo Error %u
   SetSecurityDescriptorDacl Error %u
 InitializeSecurityDescriptor Error %u
  LocalAlloc Error %u
    SetEntriesInAcl Error %u
   AllocateAndInitializeSid Error %u
  SetAclInObject  GetNamedSecurityInfo error %u
  passed in SID is System SID passed in SID is Admin SID  AllocateAndInitializeSid Error %u   IsFileOwnedByAdminOrSystem  Could not create directory %S ec=%d CreateParentDirectory   Created directory %S    \ \ ? \     CreateBaseDirectory %S%S    %S %S   LogDSFileTrace  pfnMethod failed. ec=%d.file=%S     dwErr != ERROR_NO_MORE_FILES. It is %d  Base dir %S Ignoring long file %S   F i l e N a m e   i s       FindFirstFile failed ec=%d. Filename is %S  FindFirstFile returned %d   ProcessGivenFiles   F i l e D a t a   i s       DeleteGivenFile RegSetValueEx error 0x%x    RegCreateKeyEx error 0x%x   WriteRegKey Setting disk space error to %d  SetDiskSpaceError   ::RegQueryValueEx(data) failed - %ls    Value '%ls' is empty... Type of '%ls' is %u (not REG_MULTI_SZ)...   ::RegQueryValueEx(len) failed - %ls ::RegOpenKey() failed - %ls SRGetRegMultiSz ::RegSetValueEx() failed - %ls  SRSetRegMultiSz ChangeCCS: pszString = %S   C o n t r o l S e t % 0 3 d     C u r r e n t   ChangeCCS   S e l e c t     C o n t r o l S e t 0 0 1   C u r r e n t C o n t r o l S e t   Couldn't get alternative name.  SRGetAltFileName    ( % d ) % s     Failed to load framedyn.dll on second attempt. ec=%d    \ w b e m \ f r a m e d y n . d l l     Buffer not big enough. WinSys is %d chars long  Failed to load system directory. ec=%d  Failed to load framedyn.dll on first attempt. ec=%d LoadFrameDyn    f r a m e d y n . d l l     Failed to load srclient.dll. ec=%d  s r c l i e n t . d l l     Failed to load framedyn.dll LoadSrClient    Filename not of proper length %d    GetVolumeInformation failed : %ld   IsVolumeNTFS    DeleteFile or TakeOwn failed with %d    RemoveDirectory failed with %d  Delnode_Recurse failed with %d, ignoring    Delnode_Recurse failed with %d  E x i s t i n g M o v e d   e n c r y p t . t m p   Src='%ls'   d:\xpsp\admin\pchealth\sr\utils\ntfs.cpp    ClearFileAttribute  ::SetNamedSecurityInfo failed - %ls ::GetTokenInformation(get) failed - %ls ::GetTokenInformation(query) failed - %ls   TakeOwnership   ::BackupRead(TRUE) failed - %ls ::BackupWrite(TRUE) failed - %ls    ::BackupWrite() failed - %ls    ::BackupRead() failed - %ls cszDst='%ls'    cszSrc='%ls'    CopyACLProtectedFile    FEExportFunc    FEImportFunc      cszDst='%ls'    szTmp ='%ls'  ::MoveFile failed - %d  ::CreateDirectory failed - %d   ::CreateDirectory(tmp-in-root) failed -%d   ::CreateDirectory(tmp-in-DS) failed - %d    SRCreateSubdirectory    SetFileTime of dest file failed ec=%d   GetFileTime of src failed ec=%d CreateFile of dst failed ec=%d  CreateFile of src failed ec=%d  CopyFileTimes    File is encrypted %S   ! GetFileAttributes ec=%d   IsFileEncrypted IsParentDirectoryEncrypted  !SetFileShortName (it is a FAT drive?) %d %S    File was=%S ::CreateFile() failed - %d  SetShortFileName    ::SRCopyFile() failed - %ls   szEnc ='%ls'  ::WriteEncryptedFileRaw() failed - %ls  ::OpenEncryptedFileRaw(write) failed - %ls  ::SetFilePointer failed - %ls   ::ReadEncryptedFileRaw() failed - %ls   szSrc='%ls' ::OpenEncryptedFileRaw(read) failed - %ls   szEnc='%ls' ::GetTempFileName failed - %ls  i e f   szTmp='%ls' c e f   ::CreateDirectory(tmp-in-root) failed -%ls  ::CreateDirectory(tmp-in-DS) failed - %ls   ::DeleteFile failed - %ls   CopyEncryptedFile   ::CopyFile failed - %ls Source file does not exist...???    Dest %S Source %S   SRCopyFile  Thread(%08x) got DS lock    Thread(%08x) cannot get DS lock CLock::Lock Thread(%08x) released DS lock   CLock::Unlock   INTERNAL__AsyncBinaryTrace  INTERNAL__AsyncStringTrace  INTERNAL__SetAsyncTraceParams   INTERNAL__DebugAssert   INTERNAL__FlushAsyncTrace   INTERNAL__TermAsyncTrace    INTERNAL__InitAsyncTrace    a t r a c e . d l l     EnabledTraces           -\~p OsM  K.$<5IkQ O sM  K.$V~  2@sM  K.$x|sM  K.$Gy1W     uD| O tD| O #y Os1q4L|WJV32 O 2 ZY4H*w}v<5IkQ O 'yH Zw<5IkQ O E:  K.$fKgq O( I#y O0eO Kp>Wm7. O 32 O 2 ZfV OUKVCZ ZQZ: ZQZNm7. O P o l i c y \ P o l S e c r e t E n c r y p t i o n K e y   F   S A M \ D o m a i n s \ A c c o u n t   C   V   % s % 8 . 8 l x     S A M \ D o m a i n s \ A c c o u n t \ U s e r s \     NTPASSWORD  C o n t r o l \ L s a \ D a t a     C o n t r o l \ L s a \ G B G   C o n t r o l \ L s a \ S k e w 1   % s % 0 3 d \ % s   C o n t r o l S e t     C o n t r o l \ L s a \ J D     0123456789012345678901234567890123456789    !@#$%^&*()qwertyUIOPAzxcvbnmQQQQQQQQQQQQ)(*@&%      H                                                           |\\!   RSDSG5B]>Lb   srrstr.pdb              np 0A UA }A A A A A B ^B B B B C C C D D CD ]D D D D D D 	E 1E KE eE E E E E                  \\u \u A   A   UEPuu ]UV  EtV  Y^] VFtPj X\P\\f & f 3@^U|\SVW3EEPSSSSSSh   j jEP3]]]]]]E\uC)t \   jh$\h   h$\    Vh$\SzEPuS u2s \tYjh$\h   h$\ t?Vht$\\t+jh$\h   h$\q tuh`$\S}9]t	u\M_^[  U4SVWEP3j(}}L\P\uG s j[\  Sh%\h   h$\ d  Vh%\WP  EPuW\u;r j[\(  Sh%\h   h$\   Vh%\E5\jEE[EEPEPjEPWuE   ]u;Ur \   Sh%\h   h$\    Vhd%\3P\=  u.\t|Sh%\h   h$\ tcuh$%\9}tJ9}vEWWjEPWuu3q \t+Sh%\h  h$\ tVh$\E   9}_^[t	uT\E V4\3j Vh\'\u=\  jh@'\hS  h$\    h'\V*YY   Vh&\u\   jh@'\hX     Vh&\u2\   jh@'\h^  h$\    h&\Vhh&\Iu-\tcjh@'\hc  h$\] tIh<&\IVh&\u-\t'jh@'\hh  h$\! th%\3F^Ud  |\SVW}\Eki h  P5q\<\'\$\uNo \t'jSh  V th'\j 5q\P@\t'f? t!5q\PD\WPD\\t(jSh  V) tPh'\j <jY3P3PWWWWWWPWD   H\u<n \t>jSh  V t,h'\W5T\M_3^@["   U@  |\SVuW}E)\g     -  h  P5q\<\5q\PD\P5q\hX(\S    j5q\5q\SZ    h  j 8\P<\jCf   @\  j@Ph   5 \D\PP.@ uE\>  jhD(\h  h$\    h(\j '  tN39VFVPNA1     \D(\$\t jWh  V~ th'\j YYj ] u)\t jWh   VJ th'\j dYY3FV5q\5q\S  t9PP   g   > 5q\hX(\S\ _^[t<\Md   UW~\e 3}}+  SVj[EPEPEP5q\  5q\]V]\t8\k \   Sh)\hC  h$\!    Vh(\K5q\5q\V\t?k \   jh)\hJ  h$\ tfVh(\WU9}u0\tHSh)\hO  h$\ t/h(\WYY EP  tM3FV  tu^[M;t$  }ME_VWwGtjnNy_^3  )\HHHHHH0A\1  QVM )\e q6M^d    UQEf  e VW~OxKSD\FB  uF  t"h0)\uF  PuE   Oy[E_^ UVCEtVR  Y^] UW3\}}}b jEPW  t+VuN;|!E  uNyEm  ^M_UQSW3\]b };u2\
  jh)\h|  h$\d    h|)\;u=\   jh)\h  h$\'    hh)\S>YY   Vjo  ;Yt3;u2\tujh)\h  h$\ t[hP)\SYYLESNQPF  uF\t'jh)\h  h$\ th4)\SYYP^hE_[ 7E   tj3@UA\z  QVWNu  3N}  NEx  M>~~ ~,~4~8~<~@~H~LF(  F0   _^d    UA\  QVWuF=4\E   tPF tPN  NE 
  MN  M_^d    }A\m  e Vq  ~5q\MR  e E     MEtM_  M^d    }A\  e Vq%  ~5q\M  e E   D  MEtM  M^d    }A\  e Vq  ~5q\Mz  e E     MEtM  M^d    UVuN  uN  ^] US3Vu\; u&W=@\P&VEj Pujjf5 \0\_u<}d \t.jh*\h  h)\D~ tVh)\j ]^[] U(  |\ S]VWEO  PP  O  P5P  O~  P5P  j PVPS8\u<c \tyjh|*\h  h)\i} t_Vh`*\j{M9t;\t<jh|*\h  h)\,} t"Vh4*\j{?
   M_^[   A8UQQSVF0N4^,W~(+}x3v-V(~,j v@+QP@  j j
RP  ~(^,~(FHFLt5FHvLj h   VPE  j jdRP  VuRP  3j h   SW)  PVh*\u,\_3^@[ UEA<] UEA@] U  |\f VWE3   f  VPh*\<\t@VPh   P&V u#Ph*\$\tj j jP(\M_^  U  %  |\ S]VEF<;W~    =D\h   Ph   5 \th  Ph  5 \8vtk"\PWh  P  jPPS \uF<p  twN#  P3 tRh(  f  WQQ \3  jh|+\h  h)\z   Vh`+\j 4   ^jN  P3 tEh(    WP \   jh|+\h  h)\y    VhH+\&V@;V8   ~(F0^,N4+x!vQPj R  j j
RPT  RPN  PQ2 t6POP \t5jh|+\h  h)\!y tVh$+\F@F8   M_^[   UVW39FuhN;PuWX\P0\QWX\P4\;u2\t>jh+\h   h+\x t$hP)\WYYFFNUF3G_^] UE;|3QVu4;A^|@A3@] U0SVW$3}E   E  %   2EEPh  W5q\h  \;uFEP5q\u.7 EP5q\u7 tEP5q\u7 u\/\t&jh4,\j`h)\iw tSh,\WW^HSEPu}},\uB\  jh4,\jgh)\w   P\Ph ,\W*  E   [;Uw
r;sSRj uF(N,`  j jdRP5  EE;EUrw;EvEU;wr9UsE9MrwE;EvEMEN4V4N(F0F,;|V0;sN0F4j Wv4v0   j WRP  }]F0V4\t.jh4,\j{h)\ v tWSv4v0h+\j tN4;F0|;v
F0N4V(+]^,}xN} vF+EMx:v4j jQP|  j j
uu  uuSWX  F8f8 F8F@_3^@[ U$  |\EES]EVESN=    WP  WPS \uRP\=   tEZ \tHjh,\h   h)\t t.ht,\j fe P$\d~P@\3PPPPPWPS(\uMfZ \t*jh,\h   h)\-t tWhP,\j FP@\_f:uf\uf uf PN  PN  uuS3@#N<M^[N   U  |\ SVW}j EPj[SVW\uEkY \  ShP-\h%  h)\0s   Vh8-\j E  9tD\k  ShP-\h%  h)\r N  Sh-\j{3  PW  u>\  jhP-\h*  h)\r    h,\j YY   3f9u2\   jhP-\h/  h)\Jr    h,\PNW  PW]  u\t~jhP-\h7  5PN   PW&  u.\tGjhP-\h?  h)\q t-h,\S2PN  3@#N<M_^[5   UV& } t   E@jXtEt	Eu\t+jh-\hm  h)\$q t6hl-\j <^] tj?3@A\-  <  |\VW}Eh  3P\uFV \  jh.\h  h)\yp   Wh.\V  Vmu  S.\)\\t'jSh*  W+p tPh.\V?Ph  PP \uKP\=   t>U \  jSh/  Wo o  ht,\  Pf$\dB  \t'jSh:  Woo tPh.\VP\t-\  jSh=  W)o   ht.\   Ph  V5q\h  \;   P5q\   D. \VPVP,\uV3;wAr
;w5\6  jShP  Wln    hX.\VYY  Vh   jVjh   P\uGCT \   jSh[  W
n    h4.\V   PT\jPE  Y;ut	M   P   y, Vtj    1   3PQPPPt^ 3h  P\   +\t jShd  Wm thP)\j YY39[t\M_d    M^p   A\  SW}3;u:\   jh.\hQ  h)\}l    h.\SYYyVjP  YM;]t	3M;u2\tEjh.\hY  h)\l t+hP)\S8YYumt37C^M_[d     U  |\ S]VW}SNE    uP} .  Ph  PS \uTP\=   tGtQ \y  jh,\h   h)\7k [  Vht,\j LF  fe P$\d~:Q \  jh,\h   h)\j    Vh/\3PPPPPh  PS(\urP \t/jh,\h   h)\j thP,\j f %G0PP@\8  PP@\f:uf\uf uf PN/  PN   wwS3@#N<M_^[u   A\    |\SVuEEW3L_ Vh\P}) h)\P\\t/jh8/\h  h)\(i tPh.\W<PL ;   P? j[\  Sh8/\h  h)\h tVh-\W\  Sh8/\h  h)\h   Ph-\W  ;uI9}Lt* 7PH ^ PLr ;uPL   \8  t-jh8/\h  h)\g tVC0Ph(/\W9tVpNxJ@<iP\tNyt8  PC0P3   jP  Y;Et3;E    9u  t33@PS7t-=tb2f98tVVtCWuG;tML6 M_^d    M[Y   PL ;v   \tjh8/\h  h)\Nf uhP)\WeYYcA\k    |\S]VW3`E P5q\}5q\h    t#9tsCWj@?Ny}  Wh\P% h)\P\\H/\)\t(jWh  Vle tPh.\j P` tuPC< \   jWh   Ve tSh-\j 2\   jWh!  Vd    Ph-\j    ` t<P; \t'jWh)  Vd th-\j s@C<9P` 3;tH0;tf9t  RPjRNy   M` M_^d    M[   B\3    |\l SEEV\Spw" uGI \  jh\0\h~  h)\c   Vh<0\j   \W\0\)\t"jWh  VUc tSh,0\j nhP5q\5q\h  C  u6\t  jWh  Vc ^  h0\j YYK  h tA\t jWh  Vb th/\j YYp    pj   upj u-\  jWh  V\b   h/\R39E  PPSt  e   PtEh  thtVS9 \t"jWh  Va tSh/\j E   Mt    t	   *  ;E   Pt       tud\t-jWh  VJa t  Ph/\j X  ;ElupPHRS8 \jWh  V` Sh\/\E   Mt  l   _Ml^d    M[6   V3  @tQT\t^VWh  Q5q\3<\u;JF \t.jh1\hp  h0\` tVh0\W+3G_^UVW3  t2\k  jh1\j6h0\_ P  h1\>  L7  WWjWjh   V\  uCE \  jh1\jAh0\R_    Vhd1\Wh   WMQjMQP\u73E \   jh1\jEh0\^    Vh8-\}t6\tzjh1\jEh0\^ tcujh-\j{M}rstru}logu}   u3G-\t$jh1\jKh0\q^ th41\WYY_^U  |\ E  MVu$u>\  jh1\h   h0\]   h1\j YY  SWj_N  $\tN  P| tP|GN0(W  t(H  P|GWjX\P0\u=\  jh1\h   h0\E]   h1\W\YY  EFGFGFGF8GF<NG  P\P$,h1\P,\,PGP  t,P\P$,h1\P,\,#P;P  ()  t1(  P\P$,h1\P,\(  ,#P;P4  j  PSW  8\u< B \tyjh1\h   h0\[ t_Vh`*\j{M9 t;\t<jh1\h   h0\[ t" Sh4*\j{
   tWj X\P\\_[M^   U  |\ E  M(MS] u>\  jh2\h  h0\Z   h1\j YY  VW=$\j^tSt ( t(tFVjX\P0\3;u=\j  jh2\h  h0\QZ L  h1\WhYY:  S\~~~P ,h1\P,\,PFP  (PP ,h1\P,\,P7P  j 7P  j $PWV  8\u<? \tyjh2\h!  h0\`Y t_Wh`*\j{yM9$t;\t<jh2\h!  h0\#Y t"$Wh4*\j{6
   tVj X\P\\_^M[   U  |\EV  W33u=\   jh42\h:  h0\X    h1\VYY   MMVQjQP8\u<E> \ttjh42\hD  h0\X tZVh`*\j{%Ht<\t6jh42\hD  h0\W tjh4*\j{3GM_^T   VtV  Y3@^USW}3;u:\   jh|2\h  h0\GW    hT2\S^YYrVh    ;Yt  f3;u2\tBjh|2\h  h0\V t(hP)\SYYt37C&^_[] UQQSV  W3}}u:\   jh2\jvh0\rV    h1\WYY   uWMQjVP\u@U< \   jh2\jzh0\V    Vh8-\W1y}t6\tjjh2\jzh0\U tSujh-\j{=~ v,EP  t"uMte G;~rE   3M<M;tpE_^[ U(  |\SVEEW}h  P5q\3<\u:3; \  jh2\h  h0\T   Vh0\_Sh   jSSh   @P\uF: \  jh2\h  h0\T   Vhd1\S  58\SQjQPrstrlog   uGP: \&  jh2\h  h0\T   Vh`*\j{(   tG\   jh2\h  h0\S    jh4*\j{   SPjWu!9 \t|jh2\h  Qt0\tYjh2\h  h0\FS t?j{39_v!@tF;wr   T\M_^[   U}uEP \ \3@] UEt t=  t	!t33@] ^B\  QVW~u2\~  e N ~  N(E~  N0E~  N@E~  Euf FEFEEF>  f8 f< M_^d     3 B\  QVuN@E   D  N0E8  N(E,  N E    MN  M^d    UQEVWj_t%EPjN  MPG  t
E`< x8Et%EPj N   MPF  t
E`< x8_^ B\J  QVuh   uuuaue N@2\   M^d     UVuh   uu2\^] B\  QVuh   uuuue N 2\  uN@y  M^d     B\t  QVuj uuuue N(2\-  uN@"  M^d     UVujuu@ 3\^] B\  QVujuuuue N(3\  M^d     (&  B\  QVuj@uuuue N 3\S  uN@H  M^d        U  \|\S]VuEWt*jh3\h  hd3\N tVhT3\j V5@\SSP=\j\PYYt\;tRf  j\PYYu*\tcjh3\h  hd3\@N tIh83\9PSf\ 1\t(jh3\h  hd3\N th$3\j YYM_^[   B\    |\SVu WEEPjuMue {H3\y  } Et.uVsP  YCTt`FPEVP@\PP\P:  cT M_^d    M[   USVWN  NHE  \EP4\d3\t*jSh  WL tvPuuh,4\j NHx    3PPjPPh   u\E   P\PF<F8   P# \\  jSh  W#L t5\hd1\j 7\  jSh  WK   uh 4\j l  j P\FPuYP\PF<F8   " \\t'jSh  WK t5\h4\j uT\  P  YFTu5@F<   F8\tPSh  W7K thP)\j QYYj MQvPPu\uNP\PF<F8   " \\pjSh  WJ Z5\h8-\@uT\~T   ~P   u|1 FT8   fH   t	f fHfHt	f fHvTju\u{P\PF<F8   F! \\   jShf  WJ t5\h3\j -\   jShg  WI t}uh3\F8   gF<O  F8   \tPjSh?  WI t>h3\.F<O  F8   \t jSh*  WvI th3\j YYNHu  ~FTtPq  fT Y_^[ UVujuuEFd4\^] UQSVWN  \E4\d3\t'jSh  WH tvuh4\j vu\u}P\PF<F8    \\t`jSh  WxH t5\h4\j \t0jSh  WHH tvuhp4\j \F8   _^[ UVuh   uuv4\^] UQQSV^W~  =$\PD 
E  euA\t,jh`5\h  hd3\G tuhD5\j F8     0~  ]PS@\Sf|C\th#\S\YY\`5\d3\t$jSh  W(G tuh05\j ?u u6F8   \   jSh  WF t{h5\j YYkju, u\uMP\PF<F8    \\t0jSh  WF t5\h4\j F8   e_^[ B\  QVuh   uuuue N |5\Hx  M^d     UQQSVW_|  5$\PD 
E  euA\t,jh5\h  hd3\E tuhD5\j G8     J|  ]PS@\Sf|C\th#\S\YYO |  PD 
E$  u\tjh5\h  lO {  PS@\Sf|C\th#\S\YY\d3\t)jh5\h  VD tSuh5\j u ucPu\uUP\PG<G8    \\   jh5\h)  VrD ty5\h5\j bSufC\ \uGP\PG<G8   : \\t*jh5\h8  VD t5\h4\G8   e_^[ UW}tDVut;S$\W|Gf?\tGGf\ GGf>\uFFVL [^_] UVW39FuhN@;PuWX\P0\QWX\P4\;u2\t>jh+\h   h+\'C t$hP)\WBYYFFNUF3G_^] UQe SVWuuy    uu\   ( j[\\ 6\d3\t|SWj1VB t5\h6\j \tQSWj2VjB tuh5\j \t)SWj3VBB tuh5\j YE   E_^[ UV)EtV!  Y^] UVjuu\   WP\PF< \\l6\d3\tWjWh%  VA t5\hP6\j \t'jWh&  VjA tuuh46\j ~_3@^] U  |\SVWNE3w  \(d3\t*jh,7\h_  S@ t(h7\W(\   tAF8   \  jh,7\hg  S@   h6\j YY  \,7\tPjWhq  Sm@ th6\j YY\t'jWhr  SD@ t(h3\j X,P('u5\t jWhv  S? th6\j YYF8      ,PN0q  3G( j (\   P(,    PF< F8   \\   jh,7\h  Se? t5\h6\j y\tMjh,7\h  S1? t7(h3\j E N@u  P(1 GG~8M_^[   UQSVWNu  \E7\d3\t$jSh  W> tuh7\j u\u=F8   \   jSh  We>    hd7\j {YY   juj$ u\   P\PF<- \\tTjSh  W> t5\hD7\j \t$jSh  W= tuh3\j ~<Wtju)F8   3   H@F8F8   _^[ U  |\SVEEWN3t  N (s  \$d3\t0jh8\h7  S= t$(h7\W$$\   F<  F8   \E  jh8\h=  S< th7\j YY\  jh8\h>  S<   $h7\j   (\   \t$jh8\hF  S2< th6\j LYY,P(u9\t$jh8\hI  S; th6\j 	YYF8   O  ,PN0m  3G Pb2  tH x   u9HUr  P(\u  $m  F8      ($\   P\PF<E \\tejh8\hb  S; t5\h6\j ,\t1jh8\hc  S: t($h7\j v<j_W(N@]q  P(7- GG~8M_^[)   U  |\ VWEE~( f  uF8	     SNp  (p  \$l8\d3\tWjSh  W9 t(hX8\j \t'jSh  W9 t$hD8\j (\   \t jSh  W{9 th,8\j YY,P(eu_\t jSh  W<9 th6\j VYY$PjNo   P.  jYt$`< H8N8f,PN0k  3G( ($14 tF8   F< N@io  P(C+ GG~8[M_^5   U  |\VW~(Ed  uF8	     SNo  (n  \$8\d3\tWjSh  W8 t(h8\j  \t'jSh  W7 t$h8\j ,P(P tf\t(jSh  W7 t,Ph8\j ,P$2 u(,PduF8   [M_^  U  |\SVEEWN$m  \(9\d3\t'jSh!  W6 t(h9\j (\u=F8   \  jSh&  W6    h5\j YY   j( (\   P\PF<[ \\t'jSh1  W26 t5\h8\j Fv<Ztd,P(	t,PN0h  F8
   F(Pj Nl  $P+  jYt(`< H8N8F8   F8   M_^[@   Vj N9l  PuF8   ^U  |\SVWEE~$k  N(k  \(tbjh\9\hw  hd3\5 tShH9\j \t/jh\9\hx  hd3\4 t(h49\j S S(0 F<   Pt<,PSt4S(/ F<u,PN0f  F8
   mF8   d,P(/ F<u,PN0Mf  (Pjj  $P)  jYt(`< H8N8F8   M_^[   VNj  PN0j  PuF8   ^U  q  |\  SVEEWN1j  N #j  \|:\d3\tWjSh  W93 thh:\j M\t'jSh  W	3 thT:\j \uxF<  F8   \
  jSh  W2 th4:\j YY\  jSh  W2   h7\j   \  \  \t jSh  W!2 th:\j ;YY P\  \P@P\s  \t jSh	  W1 th9\j YY\P@\\j\P\YYtf  h9\\PD\\P\PD\,P\P u5\t jSh  W1 th9\j /YYF8   =  \t(jSh"  W0 t,Ph9\j ,P\uHP\F<\tjSh)  W0 t,Pv<h9\j d,   \1\t1jSh7  W,0 tP\Pht9\j ? ud,Pu5\t jSh>  W/ th6\j YYF<      ,PN0a        \   P\PF<~ \\t]jShQ  WU/ t5\h6\j i\t-jShR  W%/ th7\j 3v<Gj_Wi~8&N@e  Pu!  @@F8M_^[a   VN\e  PN Se  PuF8   ^Vj N0*e  PquF8   ^tj.3@C\u      |\EES]0EVu(H@W34$ 86  u6\S  jh:\h  hd3\- 5  h:\W  =@\S@Pv@P@%  @,u  @  H  H6  HH     tEr  jH  Y<E     @Q84  Ft;P$\~00PFPPvPf     jH  Y<E   `  vQ@Q84(9  jH  Y<E     q@Q84  jX}  Y<E     0,  (  $  PQ<R@P84  0PFPPvPjH  Y<e S  Q@Q84/  SPvPRjH  Y<E     vP@P84  =     =   +  =      =      =   tD\=  jh:\h  hd3\*   ph:\j   vPjH~  Y<E
   .  Q@Q84
  jH~  Y<E	      @Q84   jHS~  Y<E      v@Q84   SPvPjH}  Y<E   tYvP@P847jH}  Y<E   t@Q84g3Mu\  jh:\h  D  (Wcu]    W  ,   $      jX}  Y<E   t=0,  (  $  PQ<R@P843Mu\   jh:\h$     (W@,   x   jHt|  Y<E   t#q@Q843Mu3\tMjh:\h4  hd3\' t3hP)\j YY#(Vu	4
$   M$_^d    M[y   UVWu3u\;t7\tejh?\h  h>\' tKVuh>\W.7\t+jh?\h  h>\& tuh>\W3G_^] U(  |\MSVuEEW5hr\}EEPh<@\Qh$@\3P,\P\Ph  SWV\;tJ\@\>\t,jWh  V
& th?\S   SP\;>\@\t.\tjWh  V% th?\\t&jWh	  Vt% th?\S   9t\9u<\)  jWh   V%   h?\S   PPSh?  SSS\;t<P  \   jWh/  V$    hd?\jP\;t7P\  \tWjWh5  V2$ tEhD?\-\t&jWh7  V$ th(?\S9_^[t\P\Miu   UVuV$\DF^] U(  |\ EES@\EVW}EWPj\P\YYu6\  jh@\hc  h>\# q  Wh@\   f& FF\t1jh@\hj  h>\" tVPh@\j =\Pj PVPtHP  \  jh@\hn  h>\]"   Vhx@\j r  jX\P0\u@\t(jh@\hs  h>\" thh@\j YY   1  QPPVPtHP  \   jh@\hz  h>\!    Vhx@\j    Pj\P\YYu4\   jh@\h  h>\'! tsh@\f& FF\t1jh@\h  h>\  tVPhP@\j VP\ tj X\P\\M_^[3r   UV395<r\~u4(r\\tF;5<r\|3^] 3@3HHHHHH$  (  ,  U<  |\SEEV5\WEP3h?  WhA\h  ;t#S  \  jhA\h  APh  Wh8A\;t>Sg  \  jhA\h  h>\5   Vh|>\p  PWPWPPW  \;4  >\\t+jhA\h  V tPh,A\WP%  jX\P0\;N  QPPWP\;R  ;  f98  \A\t&jSh	  V th A\W$\DA*  \tp\tjSh$  V thA\WYYP@\P^  P   \tjSh  V7 th A\WRYYP@\P$\fEP  5r\P(\tjSh  V th@\WYY;QWX\P\\PWPWPP  \;Cp\t#jhA\h  V thh@\WYYj[?S  \t*jhA\h  V th@\W95\t9tWX\P\\9tM_^[m   U  |\VuWEE3f9>      SS$\\D8t4jhB\hW  h>\ tFPShB\j Ff; t{h<@\hA\P,\\t5jhB\h_  h>\p tD~PPhA\j ~D~PP S$\|~f; 
[M_3^k   U$  |\SEEVW3f3   R5Tr\f  W\;tGP  \  jhB\hz  h>\   VhB\S  P5Tr\3FW\;t;PC  \  jhB\h}  h>\   Vh|>\h  P5q\<\5 r\PD\P5q\5r\I  /  V5Xr\5r\5I  B\>\u1\t(jSh  Vs tP\PhB\j jC@\t.\t jSh  V6 th|B\j PYY3@3P5\r\5r\H  u1\t(jSh  V tP\PhLB\j 5lr\5,\h4B\P   5r\5lr\SP5pr\h4B\P5r\5pr\SP5tr\1\5dr\SP5r\PW5tr\O5xr\5dr\SP5r\PW5xr\5|r\5dr\SP5r\PW5|r\e  39t\9t5Tr\W\M_^[g   U<  |\SVWEEP5Tr\3  S\;t;P  \3  jhC\h  h>\   VhB\aP5Tr\   S\;tGP  \  jhC\h
  h>\R   Vh|>\Wh  5`r\P@\P  5r\Ph1\P,\V5r\5r\SP;t<\t3jC\Vh  >\W t!hC\j 
>\C\5r\5r\S5r\t0\t'jVh%  W: thC\j NPhh\P0  t_PtIP  \
  jVh5  W   h`C\j   Phh\h\S  ;\    \t jVh@  W; thDC\j UYY\vLjY+\t-jVhG  W th(C\j Q\Yu8\t jVhN  W thC\j YY     39tI C\>\t t6>\C\PRhh\P3  u6\   jVhp  W    hC\j YY   \Yj5r\PB     5 r\P@\P)  5r\5$r\SP\j{#  t<P  \t'jVh  W thB\j  td  Y td  Y39t\9t5Tr\S\M_^[b   U  |\S]VWE  VMPS  t>W  \  jhD\h  h>\   VhD\  PhD\j l  S|  VPS  t>W  \M  jhD\h  h>\h /  Vh`D\  PhLD\j   P   VPS  t>W  \   jhD\h  h>\    Vh$D\   PhD\j h  P'  u|Sn  0  u_VP5r\<\P\u:~  \t*jhD\h  h>\E tVhC\j ^M_^[_   U$  |\f f S]EVuW   3f3\fO  >\t'jhlE\h	  W tSVhTE\j ~hPE\P\YYtSP\P\SVPPhE\\\$ 5\t,jhlE\h  W tPhD\j ~M_^[^   U  |\V5@r\uVEhE\P,\Ph\V  t7\t*jhE\h  h>\e tVh|E\j ~}3M^]   j 5Xr\5Pr\h  <  u6\t-jhE\j+h>\ tP\PhB\j }Ue VWh  FP5q\<\ui  \t*jhF\h  h>\ tWhE\j |  t'   t6  & E_^  Wt  PEP|tE  E    Pl6  tE   VWwGNy_^B|3  QQ    fP      (  0  C\^  QVW}e   t&   t5  &   {M_^d    UQQEe SVt  4  (  8  @DC;E   W} 4  (  @D<Gt/HHtAHHt=t8t30t-   t	-   t 8 t t@t-   uON@  tPu\t
C;]x;]}Et8E   _E^[ UVu3;t4  W(  8  RzO;_};t	BD3@^] UV_EtV]  Y^] C\]  
  |\SVW   3;E,        P\  Y,;]thJ\h \WXjS8^  3M3;(  u8\t'jhF\h8  h>\: thP)\SUyYYj_        , $  s  $  ]  $  iG  $  PP@\3WPP  \t7jhF\hL  h>\u tPPShpF\WxW  WP0Y_  E   P0Psd    t}   (  ,PPPP     +  P0Pa  t     (  ,D,  M0f  ,C;   ^3M_^d    M[X  WW  \t]jhF\hZ  h>\) tCVhHF\1W$  \t*jhF\hl  h>\ tVh$F\j wM0f  eUEWt%VhJ\w6jW\  EtVY  Y^vEtWY  Y_] W   Hx SV4@X(  WKu^[(  tjn  3_D\_Y  P  Z  |\SVWE  3P]$(<  h:\PP  P:  ;tD\I  jhG\h4  h>\ +  WhdG\hXG\Su     ;u=\  jhG\h9  h>\.   hDG\SEuYY  5Dr\0PPW  $  M48   P  ;@s  >\@3;40  Wj0VD!\  hEi  5Lr\VPE  WjP;  /  h<G\VP  WjP  6  hPDr^  3;t	'  9<thc  ;<   htc  ;E   lPVP  5Lr\VP  PP\  WjP`    hc  ,VlPP0   .hPDQ[  \tIjhG\hy  S t3hG\$\t#jhG\h  S thG\WsYYhE)h  DE ]  8 tB0 t^@4$P  8 @,<$P  @@ 33M  M_^d    M[R   \   jhG\hY  S    WhF\   \   jhG\ha  P\\tjjhG\h  S  tTWPPhF\j q4\t+jhG\h  Su  tWhF\hXG\j qhEf  DE [  tj+3@U	  |\SVW39   E4  >\  4  (  8   @| `  4  (  8  @L<   $  3QQ  RQQh  $QBP(\tC uz\  jhI\h  S@    hI\j VpYY  P\\t+jhI\h  S  thI\j p8I  OhtI\5  P\thhI\Oy5  P\u6t6htI\P\t hhI\P\t
0     4  $  Pj j ~P,\uMP\\v  jhI\h  S  \  h@I\j &oB   5  r  #  \t$jhI\h  S  thI\j nYY  4  rt4\t+jhI\h  Sp  thH\j n4  $  Pj j }P,\u&P\\tfjhI\h   wLr  w>\t$jhI\h  S  thH\j mYYjpd  } 0  VP\G<_8 t0jhI\h  h>\  t ShH\j m    p   \t(jhI\h  h>\0  thH\j JmYY  4  Q  VP\G<_8 t0jhI\h  h>\  t ShH\j luA puJ\t(jhI\h  h>\  th\H\j lYYjp    
  G=   t=   t
 t@u[8uU$  4  O01  O1   @{  P g< G8   4  $  	{  PW8  f  } u
8d        8   OG1  8   L4  (  @DH   t   t
@t uH0  P \t4  (  C@;\|4  (  @;\}b,P     ,P \  4  $  y  P,P g  X  8  4  (  8  @;T>\4  4  ;   g3h\WPhh\h\h  =\\t=\\t*jhI\h~  S  t5\h<H\Wj9   4  +  4  (  8   @|   4  (  8  @D<G8
c  c  \t$jhI\h  Sg  th$H\j iYY  O    \tjhI\h.  h>\   thG\\tjhI\hN  h>\  thG\P\PG8   G<  \>\I\  jVh\  W  tShG\j h\   jVh]  W  t hG\j h\   jVh^  WK     ,PhG\j Zhu=P4  $  Fw  PW8  tH    8  4  (  8  @;T4  4  ;   M_^[MH   D\J    |\  SVE   HWx<@X(  VKu  j jk Pj{  >\   \t&jhJ\h	  S  tWhJ\j g    j(   Pj  t<\  jhJ\h	  S  {  WhXJ\j ff   1  3;t5\F  jhJ\h 	  SX  ,  WW  Ph8J\9   $  $$  t  $  t  $  t  $  tPP@\3WPP  \t8jhJ\h4	  S  t"PP$hpF\Wej  WP(pL  }	P(PQ    ;   t7P&  \   jhJ\h@	  S     WhHF\s(  PPPPtRP(PM  t;t7P  \t&jhJ\hS	  S  tWh$F\j d(PUS  M(S  $$;   j   39      $  r   $  r   $  lr   $  rPP@\3f9uf\ fWPP    5Hr\Ph(J\P,\PhI\W  PiC;   3  j jFM_^d    M[C  USW}3;u6\   jhJ\h	  h>\  t~hJ\SbYYoVh<  F  ;Yt3;u2\tBjhJ\h	  h>\o  t(hP)\SbYYtt37C^_[] CD\qE  d  |\SVWE#  3}c  WE    WW  ;k  EP    E5Hr\hK\P,\EPEPP  h<@\PD\PP  ;t3\   jh`K\hl  h>\R     Sh<K\jEPEPP  P  ;tIS  \   jh`K\hw  h>\  tyhK\W`c,    j  W;uB  Wj  9>t0PP0;t  Sj  Wj      h  \j   j_    tE a  M$  M_^d    M[@  UM] UQSV  3]I     EWSSVh)\SS\;uC  \   jhL\j`h>\\     WhK\Sr_          h  W\u//  \tcjhL\jqh>\  tLWhK\=  u/\t4jhL\jvh>\  thK\S^YYWT\E   _  C  E^[ U$  |\SVuWEh  P5 \3  \P$\G  uhL\P@\h\L\P@\PV  Ph  SPV\;   PPPSh0L\\;   3   PuS\} t0   f; u&PuP@\fu (tS$\t;rfu xPj h0L\\ _^[t\Mu=   Ut|\SEEVEEW3EjEPEP]]]]]]]]E]\SEP\     ]EPh    EPEPu  ;|{  tE   9]]vK39]tu  ]EPEDPu  ;|8uEP\tEEE;Erue  9]]k  9]tuG  M_^[T<   EM]3Ul|\EEEESEEVE3h"\EP]]]]\Sj1EPEP%  ;   EPui;   EPuh u  ;   WEPSEPSEPu    ut;   9]]vz]EM<EPEPEPSSuuuW|  ;|<EPWh   uN  ;|$EEEPju]]"  u  EEE;Eru  }  >_9]tu  9]tu  9]tu  M^[:   U8  |\V3EPjPV     $  Ph  V5r\h  \;   W=\PPPV5r\  uHfEP5r\D  ;   5r\\PPPV5r\  uDfEP5r\  ;u5r\\_9^t\M8  3 USVWu35r\  S}}}\;t7\  jhM\h  hTM\  n  Vh@M\WZ  =\EP5r\StF\<  jhM\h  hTM\    V5r\h$M\j W  EPu  PP\t6\   jhM\h  hTM\&     VhM\   u\e EP5r\St3\   jhM\h  hTM\  tmV5r\JEPuD  |QE;EvIPu  PP\t3\t*jhM\h  hTM\s  tVhL\j V} t	u\5r\S\_^[ ]D\q9    |\SV3WE|xJ  ]{  tPSjj\PP\;  t?\  jhLN\h   hTM\    Vh0N\SU  P9  uDP\\H  jhLN\h  hTM\Q  *  hN\LP}C  ;t<\  jhLN\h  hTM\    hM\S  PPP)  5D\h<@\Ph#\P5r\P5r\P\P5r\WtA\D  jhLN\h  hTM\M  &  5r\hM\b  |P5r\W\t<\  jhLN\h"  hTM\    5r\  PPP  h<@\Ph#\P5r\P5r\PP5r\Wt<\;  jhLN\h/  hTM\D    5r\xP5r\W\t<\  jhLN\h6  hTM\    5r\   PPP  h<@\Ph#\P5r\P5r\PP5r\Wt<\7  jhLN\hC  hTM\@    5r\P5r\W\tK\   jhLN\hJ  hTM\     5r\h$M\j Q   x|PP\t0\tnjhLN\hQ  hTM\w  tThM\=ft8\t/jhLN\hX  hTM\8  thM\j LQ| t|\5r\5\Wt9\t0jhLN\he  hTM\  tS5r\hM\j Px tx\5r\Wt9\t0jhLN\ho  hTM\y  tS5r\hM\j P t\5r\Wt9\t0jhLN\hy  hTM\  tV5r\hM\j /PtPj tj\j WN  M!E  M_^d    M[d0  U$SVW\"  h`N\EP\ \3EEEEEP  VEMPE   M}>4  u2j j EPVEP\   @t5  uEPVEP|$h`  u\  ;u	t  u\|WP\_^[ 3PPPh9\PP\USV5\W3$EP3\uEP\EP\WWEWPu_^@[SVW33;tGSSjP\u8M  \tMjhN\j_hN\  t6VhN\S1N%F;=\tP^F;tP^3G_^[U  |\SVW}E3+~t}HtXHt?\I  jhTO\h   hN\  +  Wh8O\SM  FkZjdY&  F$*EFFjdY%  ^ F$$  ^$h   PW5 \fD\uI  \   jhTO\h   hN\  thWhO\SLQPh9  6\u9  \t)jhTO\h   hN\|  tWhN\SLSv$h  h8  6|\3CM_^[,   SVF3+W~$   HtIHtA\   jhO\h   hN\     vhO\SL   ~oF F N;v=\t.jhO\h   hN\  tvv hxO\SKNN ;v!F HF3jd_F|;~$tSWh  h8  6~$|\3C_^[UQQVWEP3E   E    \u;*  \t.jh$P\h  hN\  tVh P\WK3G_^U<e SVW=\j uG  \  jhP\h7  hN\    VhdP\j J  jV\3V5\oMCtM;Kw  PK\3PPPPEP5 \0\EuJ  \B  jhP\hR  hN\  $  VuhDP\j I  MQjP\ju\  @ t~j PEuEEEP\u=\uEuuEh   uQ3WHQuuPWWu \uuuu\EE3h6  uC\EPV\jEPuW \sWhr  V\E+Ej+Euu+EPuWV\E   E_^[ Ux|\EES3VuMHHW}]Ux    n  -   t=(d  jQ\=6  t=7  t3jV$\j \E0  5|\RRj1h7  W;MQj\P\W\jZPE\kjHYuE  WE\EP\j Pj0h7  WCWEPh8  W\P\M+MjdkFK[UQj h  8  SWBj j h  SWeW[W\u<Y  \tGjhP\h  hN\   t-VhP\j 9Gjj W\R\E   ME_^['   UVqEtV)  Y^] UV3}  uuju\Eju\tuuuu^] SVWVhB\3Sj5 \\;u8M  \tljhN\jChN\  tUVh,Q\S1FD;>t3\t(jhN\jHhN\  t6Wh Q\SE>j6\3C_^[tj3@USW}3;u6\   jhxQ\h  hN\l  thPQ\SEYYpVj((  ;YtXXX3;u2\tBjhxQ\h  hN\  t(hP)\S1EYYt37C7^_[] UV39ut)u$\tEu0P@\E  F^]   ` VFtP'  f & Y^UVW39FuhN;PuWX\P0\QWX\P4\;u2\t>jh+\h   h+\  t$hP)\WDYYFFNUF3G_^] USV5\W3WEPj[SEPu}uA  \   ShQ\jNhQ\q     Vh8-\WC   9]t;\   ShQ\jNhQ\2     uSh-\j{DCy}  wp9}v^WEPuuuu  \tHShQ\jX\E;Et,\t+ShQ\jXhQ\  tuuEf8E   E_^[ U  |\VWEE   VPu35 \D\PVuWWPV\u8E  \t+jhQ\jxhQ\  tVhQ\W)B3GM_^"  U
  |\SVW=D\   VEPV5 \3u@  \   jhR\h   hQ\|  t}WVhO\SAkh   Pu5 \u0^  \t@jhR\h   hQ\%  t&VuSPPS \   M_^[!   UQQVWjXEEEPuEPu3uu\;t<P  \t.jhR\h   hQ\  tVh(\W@3G_^ UVWjEPju3uu\;t<PF  \t.jh@R\h   hQ\  tVh$R\W2@3G_^] UVWu3$\Pujuuu\;t<P  \t.jhPR\h   hQ\  tVh$R\W?3G_^] USW39]tyVuuu$\;~]D6P"  YGu3\tEjh\R\h  hQ\  t+hP)\j{,?YYNQuP\Gf$p 73C^_[] UVjuS^] ?UVjuf '^] D\!  SV3W}7ww_u3ssEPhS\hHS\h  E  ;E  f90E  u\   Vth   VjVVh   u\Eup  \Et_jh(S\h  hQ\  tuhS\V=\t+jh(S\h  hQ\  tuhR\V=u4\t+jh(S\h  hQ\W  tuhR\Vo=u$\MDAf90EEPC   YEPhR\hHS\h  B  ;E   f90E   u\   u\;Eup  \Et_jh(S\h  hQ\  tuhR\V<\t+jh(S\h  hQ\p  tuhR\V<u4\t+jh(S\h	  hQ\0  tuhxR\VH<u$\MDAf90EEP  YM_^[d    D\  QSVW}wE   QGtFPT\u;  \t+jh@T\h   hQ\  tSVhT\j ;NywPGtFP\u;e  \t+jh@T\h(  hQ\,  tSVhS\j D;NyOw;p;M_^[d    `   Vh\T\jjj \^u%P\3VFP\u6tV\^VFP\u6tV\u^%P\3^th'	 P\O  AUMIH] UVuuVu\PH\F;u~^] UMHtz\)McHtx\M^Hv\ut\] U  m  |\ }  S]EEVW}usVjW\jW\3;/  M   ;      N   StD{  hpT\j
hV\l\  \  jhpV\h$  ?[;  hpT\jhV\Sl\  \  jhpV\h0  h@V\{  c  P\Ph0V\j 8H  [6   Wh\PKCFGP$\Vt,&PAGPGPh  P_"PGPh"  P;PhM  W\h  Wd\39Ph  h  WmSj W\e  t	W    G  jRRhU\hU\R\-  PW`\PhN  W\P\PW\\j3PPPPjGPSX\PWT\  +     f  j ;s  wTj j-  )  HtT  h  W\\j j h   P;5 \  V5 \IVjh  PHPh  W\j Whh  Wh\P  f  VWP\u4@Dt%jC@\th'  jVWd\l  3Ph  h  WMS?Hj Whh  Wh\P\-  C\u-5\j h  WP\j h  WP\   P5|\5|\h  u
   h   P  VWL\u9\t0jhpV\h  h@V\  tPhT\j 4PP,\PVW5\hN  Wj P\CP$\t46PMCPCPh  Pg&PCPh"  P?PhM  Wh  W5\h  
 j h  PEPjh   \PEPh  WAP  VWd\39Ph  h  WP5|\5|\h  tM39PVWd\h  Ph  5 \D\PVWj VW\PH\P5|\5|\h  t|\t(jhpV\h  h@V\m  thT\j 2YYj h  h  W2h  Ph  5 \D\PVWj VW\PH\   M_^[   U<  |\S]EESZtaVsNxYW3GC4PP@\Pj hL  \Ny_^M[
   U,    |\e }  SVuEEW}uWjV\jV\ES  (  -   u  H   O  h  V\\j j h   P;=(\  W=(\{CW3GWh  PyBPh  V\=$\  H   H   -  tB  f  f!M3}f3?f fe fEEP4b  h  VP\3Ph  h  VWB$\   %  jVp\  =$\ t'V,Cu>3Qh  Vd\j%$\ >Ph  PPVt\>P$\St,.PI>P>Ph  Pg"P>Ph"  PC=\Ph  VP5|\5|\h  u
   J=   >P$\t$=P>Ph  P|=Ph#  PPh  Vh   P  SVL\   \   jhW\h   h@V\     PhV\{Y<3Ph  Vd\3Ph  h  Vy   SPSVL\u9\t0jhW\h   h@V\X  tPhV\j k-PP,\PSVh  V\\h  
 j h  P>Pjh  (\P>P  SVP5|\5|\h    \t(jhW\h   h@V\i  thT\j ,YYj Sh  V2h  Ph  5 \D\P  SVj SV\PH\   hT\j
hV\l\un\tejhW\h  3tPhT\jhV\Wl\u9\t0jhW\h*  h@V\  tP\Ph0V\j +E   ME_^[   VWwGCINy_^+UV+EtVD  Y^] U  |\ }  S]EEVuWu~WjS\jS\3;  EN  h  ($    -   h  H    ;   =    f  h  S\jjh  P\O48t88h#X\Sh\PP5 \x\uW;P<  f  VSP\H@u9G8t%jC@\th'  ojVSd\  PG<j Shh  Sh\P\a  h  S\h   Ph  5 \      D\5\Pj a  Sh   Ph  5 \   P   D\3Q@PSG3SPjjj\9_   Gj[8Pj\A7P7Ph<W\P,\PP@\ Pj hM     Pj 3hL  AC;_j[PPj h+  `\jh  j\G5=d\P  V39Ph  h  P5|\5|\h  t\39PVh   Ph  5 \D\PV\j V\PH\P5|\5|\h  Bd  \t'Sh(W\h  h@V\  thT\j &YYj h  h  h   Ph  5 \D\PV\j V\PH\  $jBj j  hpT\j
hV\l\  \  jh(W\h&  ?v;s  hpT\jhV\Vl\X  \K  jh(W\h2  h@V\  -  P\Ph0V\j $  v6   t8t	        jQQhU\hU\Q\   5\h  Sjjh  P\|O3t3@3Qh  SG0Sh\P7GF2Wh  S\P
339Ph  h  S39Ph  Sd\VWS\   M_^[N   UDVh#3\uu  'b  WEP5|\  5|\WitB9ut=\/  jhW\hd  h@V\    hW\V5#YY  EP5|\5|\Wt:9uu5EP5|\r  u}t}ujVj  Vj  Vj  Sj  ;Yt0pp3;u=\~  jhW\h  h@V\n  `  hP)\V"YYN  jSjSM3  9su=\!  jhW\h  h@V\    hxW\V1"YY   5D\   Wht\h  5 \Whv\h  5 \Whx\h  5 \Whz\h  5 \j3Y} \3E4   }E}{~]E   Ea^\C EE   EO\EP\;EuB[  \t)jhW\h  h@V\"  tVhPW\W<!j[_ E^jX jX3 jX jX U}u\7  u
\   V5\W}h<X\wu9Gu3   h0X\wu
h\   h$X\wu~h\~hX\wu~h\ihX\wuh\Th X\wu~h\?hW\wuh\*hW\wuh\hW\w%~h\_^] U|\t=@  uMVEP4\u3u0\3,\3\3EP\E3E3%  ^u@  |\|\;|\u	  u   U0  Wffffff(  EEE@jY3	 EE(E|\ |\$j @\EP<\h  L\P8\_UV39uu95,\~-,\}\ \u=h   \;Y\u3g0\hp\h p\\q  ,\Y?9uu;\;t2\	;t\-\9\sP\5\Y3@^] US]VuMZ                @                                       	!L!This program cannot be run in DOS mode.
$       re@e@e@3j@e@d@e@38@e@3;@e@3:@e@3?@e@Riche@        PE  L QH         
X   2      Y     &                                                         (\  P   d  #                      @'                                              &  <                          .text   `"    "                   h.rdata     &      &              @  H.data      )     )              @  PAGE     %  .   %  .                 `PAGELK    S     S                 `INIT    
  Y     Y                 .rsrc   #  d   $  d              @  B.reloc                       @  B                                                                                                                              UQQV  V  EEf@RfEuV  3^ UQQEPEPEPPj?  Ef% UQQj,T      Ut	t2h  .  $UQQttEPPPEPj  M   #;u2UQQEPEPEPPj  E$u* 4' 8~u* UU
:J  u$ tIt~uE
EEt3] 38* Suv  , ) [z  38* SuH  , ) [V  UM   <uE   @DP<uuQM    ] UVuV  }u    t     t  V	  ^] Uu  ] UQS39]VW]   9]tf9]tyf}rr}hPrcrwVj' u  UfEfCsuAeiCC_PDCC   fC {j EPSj um/    5 ' tj S} tj u_^[ UQMj 5 ) 5) uh   ' %,' %(' USVE333uuuu^[] UQQ3M2EUEU UQQEEEEEUM0 Uj j uH&   ] UESVu3^%Wx(SX&  T& N\FXH& f 2F  P& _^[] UEV3HDF1Fu
4Pd& ^] USVW}GD0NH& u
j j G4PuVV$W_^[] GenuineIntel U,) VW }EE   @EPEPEPEPj 5e EPPPEPj uE:utP:Vu@@FFu3uEEu5M%      =p  uEv  VR   PV M_^   USVu^ W& }OXFA1NG`H 8& _^  [] UQQS]EK VEEM& s96   W9>wy$ t/38t}UyMI	M& M3W8
M& {ug 2GV  P& SG#G`$K`& SM& 96a_M& ^[!EUPa 2A  P& ME;u UESVW}4@   t   P3x     P     ;Dt  _^[] UE   tuP$       t  MQP  ] 3W- tP5P- (& 3- tP5P- (& U<WjY33U}EjEEEXRREEEPuMRUE    M& _ Uu5  YD Pujuuj & ] U<Wj3Y3U}MEEREREEPuURE    ME   E   & _ USV   3     PW3Uv9v   G;zr;}r
       ;     ;Ew$  ; tP*   # WV%;sPVP* +]    3  |  =)  t)   e }]DEEPh) V  _^[UV     u3   SYWE v3D@9vEE   ;Gr};seP* ;s[;  u3T*M  P* +  3  9) t   EE}DEEPh) V,    _[^~ M H z         \ R e g i s t r y \ M a c h i n e \ H a r d w a r e \ D e s c r i p t i o n \ S y s t e m \ C e n t r a l P r o c e s s o r \ 0   UQM   e t@9   tEP   E"=)  uh) h h `) u   3 U() S]VuW63E}  F= @rF= @v	= @w8%EEEPj
vfE & }E   j j uWvSG  j V ' M_^[(   USV3SSEP& uEPEPSSSvj& ;uE     H`$AA   @  N`& =  EuSSSSEP\& EE9]|\uFFf> tWV  | $PrcrWj' ;Mu	E  !9]t
Su ' _E^[ U3PPPPE   P\& ] UEj j    PH& ] UVu   +    =*  ubS   E $' t;WM3Gt"Wh  ;   uE      #Eu_/   [u          3^] UES3Vup(]]f]]]]]]]]=  8  teWV   EV   Y  ;   _|V+  ;|
V>  ;}   ;tSP '    VSh) V  ^[ UVuW   ? tH  t?V@  @@@   t  @@@  V+_3^] UVhPrcrjj ' t7EFEFE0A  tVjh P!  3j V '   ^] UWhAPICT1  u  WWO,A;w=VuSAEt,9 u<uAY\0FAtEA;v[^j W ' 3_] % s \ % s   % s \ % s   U,S39- V5 ' W=' EEPrcr   MQP  =  ER  } H  SujE   MQPU  E  E@8 tPEP& jEPEP& E   E- h\(   Y* DASPjEEtrh\( 5* h uP  EPuE   EPuu'j uj uh' !  YMDASPjEu	E  9uh' h uW  5- h@( Wj WEj u} tj uE_^[ UExu@   u70  t,M   PtIt  jh jh\F Pt  ] Ue Vu   t  e EEPV'  EQ     I9Mvuh @V   IMMS       +W{  t	j P ' <hPrcr<   Wj'    uE     3V$E3v~M   I3]]D   D:   Dkd3u3  i     D   D8      T9UwUMuE   UQ       A_[E^ Ue S]    tSEE3     @VHW4@S4   :  E@hPrcr<Wj ' EuE     }3}   SE   HIIDEEQ;UEsguDR4U+E3Eu3  F   EFkdu3i  }   srEE;ErUuj F    '      _^E[ UQQEPEPPPjEuEt    GVj3   ^t3Qh   QP& u  Mt3 - t@#338* u, ) UVuNFWjYjZ;w
;# t8Ht3{;t";t uv& Hv & :v$& ,;t;t uv& v& v& tV;tN3FN#_^] USVuVNWj[;j_w
;#   I  ;   ;tU   uF uU+v& ~3Vj Y+#ERv&   uF;uE4v & V3FjY+  #}Pv & S  uF;uE3v$& V3F+   #}Pv(&    ;   ;tU    uF uU+v& ~3Vj Y+#ERv&    uF;uE4v& V3FjY+  #}Pv& NuF;uE3v& V3F+   #}Pv& _^[] UQQSVutkE81rcEPPPEPh   ]  ;r<  ;v;Wr!FPVFPFPWG;vuF0 3_  #  M1   ^[ U3}u2EHt *} t jY9Ms#  9M r3 j QPuu  ]  UQS39]]t
     MVuV`W}G(IItFIIt3It!It	E l8  td) EW9   tOp) 9   t@) 38]* t@BH* @* * * * SSuVW;  _^[ US]39tQVut5Kt.hPrcrQj ' u  (KW_PsEj s0  ^[] SVW=& j ,  SV^j _FV^2[Qj R  $Qj A  YAQ3Qj .  $QAu/H* uh* 2h* (j   YAQ3`- fAfA  fd- tfAfI fT  fQj  YfT  f$fT  fSV=L*  tp*  uej c  SX- \- tftt* u+   ffuft(t* u   fft   ftf^[H*    Cu(`- ffCffd- tffCffh- =l*  t
Qh* h* =l*  t	Yh- j q  CS3^[Qj R  $Qj A  YAQ3Qj .  $QAu'd*    uj   YAQ3`- fAfA  fd- tfAfI fT  fQj  YfT  f